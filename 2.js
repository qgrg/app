(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{235:function(t){t.exports=JSON.parse('{"lang":"zh-CN","prefix":"editor.","data":{"table.insertRowBefore":"向上增加一行","table.insertRowAfter":"向下增加一行","table.insertColBefore":"向左增加一列","table.insertColAfter":"向右增加一列","table.deleteCurrentRow":"删除当前行","table.deleteCurrentCol":"删除所在列","table.fitWidth":"宽度自适应","table.fitHeight":"高度自适应","table.mergeCells":"合并单元格","table.deleteTable":"删除表格","table.otherSettings":"其他设置","table.borderSize":"边框尺寸","table.borderColor":"边框颜色","table.bgColor":"背景色"}}')},236:function(t,e,n){"use strict";n.r(e),n.d(e,"connectToolbar",(function(){return Zi})),n.d(e,"Editor",(function(){return Fi})),n.d(e,"Toolbar",(function(){return ki.b})),n.d(e,"ToolbarConfig",(function(){return ki.c}));var r,o=function(){function t(){this.tagName="ky-element"}return t.prototype.create=function(t){return document.createElement(this.tagName)},t.tagName="ky-element",t}(),i=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-container",e}return i(e,t),e.tagName="ky-container",e}(o),l=Object.create(null),c=new function(){this.tagName="unknown"},u=function(){function t(){}return t.createContainer=function(){return t.createElement(a)},t.createElement=function(e,n){var r=t.getElementType(e);return r?r.create(n):(new e).create(n)},t.getElementType=function(t){var e=t.tagName;return l[e]},t.register=function(t){l[t.tagName]=t},t.isType=function(t,e){return!(!t||1!==t.nodeType)&&t.tagName.toLowerCase()===e.tagName},t.getByTagName=function(t){return t=t?t.toLowerCase():t,l[t]||c},t.isHelpElement=function(e){return!(!e||1!==e.nodeType)&&t.getByTagName(e.tagName).help},t.isOutputDisabled=function(e){return!(!e||1!==e.nodeType)&&t.isTagNameOutputDisabled(e.tagName)},t.isTagNameOutputDisabled=function(e){return t.getByTagName(e).outputDisabled},t.isWrapperElement=function(e){return!(!e||1!==e.nodeType)&&!!t.getByTagName(e.tagName).isWrapper},t.isTagNameInstanceOf=function(e,n){var r=t.getByTagName(e),o=t.getByTagName(n);return r!==c&&o!==c&&r instanceof o.constructor},t.isValidElement=function(e){return!(!e||1!==e.nodeType)&&t.getByTagName(e.tagName)!==c},t.isElementInstanceOf=function(e,n,r){if(void 0===n&&(n=o),void 0===r&&(r=!1),!n||!e||1!==e.nodeType)return!1;var i=t.getByTagName(e.tagName);return r?i.constructor===n:i instanceof n},t}(),s=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-box",e}return s(e,t),e.tagName="ky-box",e}(o),p=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-box-wrapper",e.isWrapper=!0,e}return p(e,t),e.tagName="ky-box-wrapper",e}(f),h=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-behavior",e}return h(e,t),e.prototype.create=function(e){var n=t.prototype.create.call(this),r=e||{},o=r.rotate,i=r.resizeModes;return!1===o&&n.setAttribute("rotate","false"),(null==i?void 0:i.length)&&n.setAttribute("resize-modes",i.join(",")),n},e.tagName="ky-behavior",e}(d),y=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-text",e.canFocus=!0,e}return y(e,t),e.tagName="ky-text",e}(o),v=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-block-text",e}return v(e,t),e.tagName="ky-block-text",e}(o),x=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),C=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-link",e}return x(e,t),e.tagName="ky-link",e}(b),E=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),O=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-block",e}return E(e,t),e.tagName="ky-block",e}(o),_=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isWrapper=!0,e.tagName="ky-wrapper",e}return _(e,t),e.tagName="ky-wrapper",e}(O),S=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),A=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-p",e}return S(e,t),e.tagName="ky-p",e}(w),T=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),N=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-li",e}return T(e,t),e.tagName="ky-li",e}(w),R=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),j=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-marker",e.canFocus=!1,e.help=!0,e}return R(e,t),e.tagName="ky-marker",e}(g),k=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),M=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-h",e}return k(e,t),e.tagName="ky-h",e}(A),P=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),I=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-hr",e}return P(e,t),e.tagName="ky-hr",e}(f),B=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-checkbox",e}return B(e,t),e.prototype.create=function(){var e=t.prototype.create.call(this),n=u.createElement(L);return e.appendChild(n),e},e.tagName="ky-checkbox",e}(f),L=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-checkbox-content",e}return B(e,t),e.tagName="ky-checkbox-content",e}(o),V=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),D=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-quote",e}return V(e,t),e.tagName="ky-quote",e}(A),U=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),W=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-custom",e}return U(e,t),e.prototype.create=function(n){var r=t.prototype.create.call(this);return(null==n?void 0:n.innerHTML)&&("string"==typeof n.innerHTML&&(r.innerHTML=n.innerHTML),r.setAttribute(e.InnerHTMLAttr,"")),(null==n?void 0:n.type)&&r.setAttribute("type",n.type),r},e.InnerHTMLAttr="ky-inner-html",e.tagName="ky-custom",e}(f),H=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),F=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-select-active",e.outputDisabled=!0,e}return H(e,t),e.prototype.create=function(){for(var e=t.prototype.create.call(this),n=0;n<4;n++){var r=document.createElement("i");r.setAttribute("index",String(n)),e.appendChild(r)}var o=document.createElement("ky-center");e.appendChild(o);var i=document.createElement("ky-rotate-icon");return e.appendChild(i),e},e.tagName="ky-select-active",e}(o),q=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Z=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-placement",e.outputDisabled=!0,e}return q(e,t),e.tagName="ky-placement",e}(o),K=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),J=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-rotate-icon",e}return K(e,t),e.tagName="ky-rotate-icon",e}(o),X=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),G=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-center",e}return X(e,t),e.tagName="ky-center",e}(o);u.register(new a),u.register(new o),u.register(new m),u.register(new g),u.register(new C),u.register(new O),u.register(new w),u.register(new A),u.register(new N),u.register(new j),u.register(new f),u.register(new M),u.register(new I),u.register(new z),u.register(new L),u.register(new D),u.register(new W),u.register(new d),u.register(new F),u.register(new Z),u.register(new J),u.register(new G);var Y="1",Q="0",$="Attribute",tt="Style",et="None",nt="Global",rt=function(){function t(t){this._model=null,this.commandType=et,this.commandManager=t}return t.prototype.getRange=function(){return this.getEditor().getNormalizedRange()},t.prototype.getEditor=function(){return this.commandManager.editor},t.prototype.getContainer=function(){return this.getEditor().getContainer()},t.prototype.initModel=function(){return{}},t.prototype.createState=function(){return{data:null}},t.prototype.getState=function(t){return this.createState()},t.isElement=function(e){return!t.isTextNode(e)},t.isTextNode=function(t){return t&&3===t.nodeType},t.prototype.getModel=function(){return this._model?this._model:this._model=this.initModel()},t.prototype.createElement=function(){var t;return null===(t=this.elementType)||void 0===t?void 0:t.create()},t.prototype.isElementMatched=function(t,e){return!!e&&u.isType(t,this.elementType)},t.prototype.findNearest=function(t,e){var n=this;return this.findNearestMatch(t,(function(t){return n.isElementMatched(t,e)}))},t.prototype.findNearestMatch=function(t,e){for(var n=this.getContainer();t&&t!==n;){if(e(t))return t;t=t.parentElement}return null},t.prototype.createBehaviorElement=function(t){return u.createElement(m,t)},t.prototype.execute=function(t){},t}(),ot=function(){function t(){this.element=null,this.range=null}return t.prototype.clear=function(){this.element=null,this.range=null},t.prototype.isEnabled=function(){return!(!this.element||!this.range)},t}(),it=Object.create(null);function at(t){var e=t.editor.getContainer();if(!e)return!1;var n=t.startElement,r=t.endElement;return!(!!n&&e.contains(n))||!r||e.contains(r)}var lt=function(){function t(t){this.pendingCommands=new ot,this.commands=Object.create(null),this.editor=t}return t.install=function(t,e){it[t]=e},t.prototype.getCommand=function(t){var e=this.commands[t];if(!e){var n=it[t];n&&(e=this.commands[t]=new n(this))}return e},t.prototype.getCommandByType=function(t){return Object.values(this.commands).find((function(e){return e.constructor===t}))},t.prototype.getCommandState=function(t){var e=this.getCommand(t);return e?e.getState():null},t.prototype.execCommand=function(t,e){var n=this.getCommand(t);if(n){if(n.commandType!==nt){var r=this.editor.getNormalizedRange();if(!r)return;at(r)&&r.select()}var o=Array.prototype.slice.call(arguments);return o.shift(),n.execute.apply(n,o)}},t}(),ct=n(1);function ut(){return u.createElement(A)}function st(t){var e=u.createElement(g);return t&&(e.textContent=t),e}var ft=new(function(){function t(){}return t.prototype.emptyNode=function(t){for(;t.firstChild;)this.removeNode(t.firstChild)},t.prototype.removeNode=function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},t.prototype.appendNode=function(t,e){e&&t.appendChild(e)},t.prototype.unshiftNode=function(t,e){t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e)},t.prototype.replaceNode=function(t,e){var n=null==e?void 0:e.parentNode;n&&n.replaceChild(t,e)},t.prototype.insertNodeBefore=function(t,e){var n=null==e?void 0:e.parentNode;n&&n.insertBefore(t,e)},t.prototype.insertNodeAfter=function(t,e){var n=null==e?void 0:e.parentNode;if(e&&n){var r=e.nextSibling;r?n.insertBefore(t,r):n.appendChild(t)}},t}());function pt(t){return t&&t.nextElementSibling}function dt(t){ft.removeNode(t)}function ht(t){ft.emptyNode(t)}function mt(t,e){ft.insertNodeAfter(t,e)}function yt(t){return!("string"==typeof t?t:t.textContent||"")}function gt(t,e,n){for(var r=t.firstChild,o=e||document.createDocumentFragment();r;){var i=r.nextSibling;if(n&&n(r))r=i;else{if(3===r.nodeType){var a=r.textContent;if(a){var l=st();l.textContent=a,o.appendChild(l)}}else 1===r.nodeType&&o.appendChild(r);r=i}}return o}function vt(t){Tt(t.startElement.parentElement,{range:t,match:Ft})}function bt(t,e){var n=e||{},r=n.style,o=n.attrs;if(r){var i=Ct(r);t.setAttribute("style",i)}o&&Object.keys(o).forEach((function(e){var n=o[e];t.setAttribute(e,n)}))}var xt={toString:function(){var t=this,e=[];return Object.keys(t).sort().forEach((function(n){var r=t[n];r&&e.push("".concat(n,":").concat(r))})),e.join(";")}};function Ct(t){var e=Object.create(xt);return t&&Object.assign(e,t),e}function Et(t){return t?Object.keys(t).reduce((function(e,n){var r=t[n];return e[n=n.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}))]=r,e}),{}):t}function Ot(t,e){return t.getAttributeNames().forEach((function(n){var r=t.getAttribute(n)||"";e.setAttribute(n,r)}))}function _t(t,e){var n=Object.create(xt);return t?("string"!=typeof t&&t.getAttribute&&(t=t.getAttribute("style")),t?t.split(/\s*;\s*/).reduce((function(t,n){var r=n.split(/\s*:\s*/),o=r[0];return/\/\*/.test(o)||e&&!e.hasOwnProperty(o)||(t[o]=r[1]),t}),n):n):n}var wt={style:function(t,e){return e=e||"",!(!(t=t||"")&&e||!e&&t)&&function(t,e){if(t&&!e||!t&&e)return!1;var n=Object.keys(t),r=Object.keys(e);return n.length===r.length&&n.every((function(n){return t[n]===e[n]}))}(t=_t(t),e=_t(e))}};function St(t,e){var n=t.getAttributeNames(),r=e.getAttributeNames();return t.tagName===e.tagName&&(["style","class"].forEach((function(t){-1===n.indexOf(t)&&n.push(t),-1===r.indexOf(t)&&r.push(t)})),n.sort(),r.sort(),n.length===r.length&&n.every((function(n,o){if(n!==r[o])return!1;var i=t.getAttribute(n),a=e.getAttribute(n);return wt.hasOwnProperty(n)?wt[n](i,a):i===a})))}function At(t,e){if(t){var n=Array.prototype.slice.call(t.children),r=e.match,o=e.range,i=void 0===o?{}:o,a=function(t){return r(t)&&!u.isElementInstanceOf(t,j)};n.forEach((function(t){if(a(t)){var e=t.previousElementSibling,n=t.nextElementSibling,r=a(e),o=a(n);yt(t)&&(r||o)&&(dt(t),i.startElement===t&&(i.startElement=r?e:n,i.startOffset=r?e.textContent.length:0),i.endElement===t&&(i.endElement=r?e:n,i.endOffset=r?e.textContent.length:0))}}))}}function Tt(t,e){if(t)for(var n=e.match,r=e.range,o=void 0===r?{}:r,i=Array.prototype.slice.call(t.children),a=null,l=i.length,c=0;c<l;c++){var u=i[c];if(n(u))if(a)if(St(a,u)||yt(u)){var s=a.textContent||"",f=u.textContent;a.textContent=s+f,dt(u),o.startElement===u&&(o.startElement=a,o.startOffset+=s.length),o.endElement===u&&(o.endElement=a,o.endOffset=s.length+f.length)}else a=u;else a=u;else a=null}}function Nt(t,e){for(var n=e.previousElementSibling;n;){if(Ft(n))return!1;n=n.previousElementSibling}return!0}function Rt(t){if(u.isElementInstanceOf(t,O)&&0===t.childElementCount){var e=st();return t.appendChild(e),t}}function jt(t){if(t||(t=u.createContainer()),0===t.childElementCount){var e=u.createElement(A);Rt(e),t.appendChild(e)}return t}function kt(t,e){if(!t||3===t.nodeType)return null;if(e(t))return t;if(Xt(t))return null;for(var n=t.lastElementChild,r=kt(n,e);n&&!r;)r=kt(n=n.previousElementSibling,e);return r}function Mt(t,e){if(!t||3===t.nodeType)return null;if(e(t))return t;if(Xt(t))return null;for(var n=t.firstElementChild,r=Mt(n,e);n&&!r;)r=Mt(n=n.nextElementSibling,e);return r}function Pt(t){return Mt(t,(function(t){return Ft(t)}))}function It(t,e,n,r){for(var o,i="function"==typeof(o=n)?o:function(t){return o===t},a=t,l=-1===r?"previousElementSibling":"nextElementSibling";a&&!a[l];){if(i(a))return null;a=a.parentElement}for(a=a&&a[l];a&&!i(a);){var c=-1===r?kt(a,e):Mt(a,e);if(c)return c;var u=a.parentElement;if(!(a=a[l])){for(;u&&!i(u)&&!u[l];)u=u.parentElement;a=u&&u[l]}}}function Bt(t,e,n){return It(t,e,n,1)}function zt(t,e,n){return It(t,e,n,-1)}function Lt(t){return kt(t,(function(t){return Ft(t)}))}function Vt(t,e){return Ut(t,e,(function(t){return u.isElementInstanceOf(t,O)}))}function Dt(t,e){return Ut(t,e,(function(t){return u.isElementInstanceOf(t,A)}))}function Ut(t,e,n){for(;t&&t!==e&&!n(t);)t=t.parentNode;if(n(t))return t}function Wt(t){var e=function(t){t&&0===t.childElementCount&&dt(t)},n=t.start,r=t.end,o=t.containStart,i=t.containEnd,a=t.container;if(n)if(r){var l="function"==typeof r?r:function(t){return t===r},c=a?function(t){return t===a}:function(){return!1},u=n,s=u.parentNode,f=u.previousSibling;if(o){var p=n.contains(r);if(dt(n),p)return}if(!f){for(;u&&!u.previousSibling&&!c(u);){var d=u===n?s:u.parentNode;u!==n&&e(u),u=d}f=u&&u.previousSibling,e(u)}if(!l(n))for(var h=function(t){if(l(t))return i&&dt(t),!0;if(1===t.nodeType&&!Xt(t)){for(var n,r=t.lastChild;r;){var o=r.previousSibling;if(!0===(n=h(r)))break;r=o}return e(t),n}dt(t)};f&&!c(f);){if(l(f)){i&&dt(f);break}var m=f.parentNode,y=f.previousSibling;if(!0===h(f))break;if(!(f=y)){for(;m&&!m.previousSibling&&!c(m);){var g=m.parentNode;e(g),m=m.parentNode}f=m&&m.previousSibling,e(m)}}}else o&&dt(n)}function Ht(t){return u.isElementInstanceOf(t,g)}function Ft(t){return Ht(t)&&!u.isHelpElement(t)}function qt(t){return u.isElementInstanceOf(t,f)||Ft(t)}var Zt=function(t,e){if(!t||t.collapsed)return!0;var n=t.startElement,r=t.endElement;return function(t,e,n){return Ut(t,n,(function(t){return u.isElementInstanceOf(t,a)}))===Ut(e,n,(function(t){return u.isElementInstanceOf(t,a)}))}(n,r,e)&&!function(t,e,n){return Ut(t,n,(function(t){return u.isElementInstanceOf(t,W)}))!==Ut(e,n,(function(t){return u.isElementInstanceOf(t,W)}))}(n,r,e)};function Kt(t){for(var e=t.firstElementChild;e;){var n=e.nextElementSibling;if(u.isHelpElement(e))e=n;else{if(!qt(e))return!1;if(!Ft(e))return!1;if(e.textContent)return!1;e=n}}return!0}function Jt(t){return!!function(t){return u.isElementInstanceOf(t,W)}(t)&&!t.hasAttribute(W.InnerHTMLAttr)}function Xt(t){return(!t||1===t.nodeType)&&Jt(t)}function Gt(t,e){var n=t.target,r="true"===n.contentEditable,o=!!ct.a.findUpUtil(t.target.parentElement,(function(t){return"true"===t.contentEditable&&(r=!0),Jt(t)}),(function(t){return t===e}));return o=o&&(r||["input","textarea"].indexOf(String(n.tagName).toLowerCase())>=0)}function Yt(t){for(var e=t.firstChild,n=null;e;){if(3===e.nodeType&&(n=e).textContent)return n;e=e.nextSibling}return n}function Qt(t,e,n){void 0===n&&(n=!1);var r=e.parentElement;if(r){var o=[].slice.call(r.childNodes).indexOf(e);o>=0&&(n?t.setEnd(r,o):t.setStart(r,o))}}function $t(t){var e=document.createRange(),n=t.startElement,r=t.startContainer,o=t.endContainer,i=t.startOffset,a=t.endOffset,l=t.endElement;return Ht(n)&&(r=n.textContent?Yt(n):null),r?(3===r.nodeType&&(i=Math.min(r.textContent.length,i)),e.setStart(r,i)):n&&Qt(e,n),Ht(l)&&(o=l.textContent?Yt(l):null),o?(3===o.nodeType&&(a=Math.min(o.textContent.length,a)),e.setEnd(o,a)):l&&Qt(e,l,!0),e}var te=function(){function t(t,e){this.startOffset=-1,this.endOffset=-1,this.isTextEmpty=!1,this.editor=t,e&&this.init(e)}return t.removeAllRanges=function(t){var e;t.cursor.isActive()?t.cursor.update(null):null===(e=document.getSelection())||void 0===e||e.removeAllRanges()},t.current=function(e){var n=document.getSelection();if(e.cursor.isActive()){var r=e.cursor.getRange();return new t(e,{startContainer:null==r?void 0:r.startContainer,startOffset:null==r?void 0:r.startOffset})}if(n.rangeCount>0&&!(r=n.getRangeAt(0)).collapsed)return new t(e,r=function(t){var e=t.startContainer,n=t.endContainer,r=t.startOffset,o=t.endOffset;if(-1===t.compareBoundaryPoints(Range.START_TO_END,t)){var i=e;e=n,n=i,i=r,r=o,o=i,(t=document.createRange()).setStart(e,r),t.setEnd(n,o)}return t}(r));return null},t.prototype.init=function(t){var e,n,r=t.startContainer,o=t.startOffset,i=t.endContainer,a=t.endOffset;if(r)if(3===r.nodeType)e=r.parentElement;else if(1===r.nodeType){if(Ft(c=r.childNodes[o])){if(c.firstChild)r=c.firstChild;else{var l=document.createTextNode("");c.appendChild(l),r=l}e=c,o=0}else e=r}if(i)if(3===i.nodeType)n=i.parentElement;else if(1===i.nodeType){var c;if(Ft(c=i.childNodes[a])){if(c.firstChild)i=c.firstChild;else{l=document.createTextNode("");c.appendChild(l),i=l}a=(n=c).textContent.length}else n=i}this.startContainer=r,this.startOffset=o,this.endContainer=i,this.endOffset=a,this.startElement=e,this.endElement=n},t.prototype.new=function(e){return new t(this.editor,e)},Object.defineProperty(t.prototype,"collapsed",{get:function(){return!this.startElement&&!this.startContainer||!this.endElement&&!this.endContainer||this.startContainer===this.endContainer&&this.startOffset===this.endOffset},enumerable:!1,configurable:!0}),t.prototype.extractContents=function(){return $t(this).extractContents()},t.prototype.cloneContents=function(){return $t(this).cloneContents()},t.prototype.equals=function(t){var e=this;return!!t&&["startContainer","startOffset","endContainer","endOffset","startElement","endElement"].every((function(n){return e[n]===t[n]}))},t.prototype.getNativeRange=function(){return $t(this)},t.prototype.select=function(){if(this.collapsed)return this.editor.cursor.update(this.getNativeRange()),void this.editor.events.emit("internalSelectionchange");this.editor.cursor.update(null),function(t){t instanceof te&&(t=$t(t));var e=document.getSelection();e.removeAllRanges(),e.addRange(t)}(this.getNativeRange())},t}(),ee=te,ne=function(){function t(t,e){this.index=0,this.actions=t,this.callback=e}return t.newAction=function(t,e){var n={execute:t};return"number"==typeof e&&(n.priority=e),n},t.prototype.isFinished=function(){var t=this.actions||[];return this.index>=t.length},t.prototype.execute=function(t){var e=this,n=this.actions||[];if(this.isFinished())this.callback&&this.callback();else{var r={next:function(t){e.index++,e.execute(t)}};n[this.index].execute(r,t)}},t}();var re=function(){function t(){this._data=Object.create(null)}return t.prototype.add=function(t,e){var n=this._data[t]||(this._data[t]=[]);-1===n.indexOf(e)&&(n.push(e),function(t){t.sort((function(t,e){return(t.priority||0)-(e.priority||0)}))}(n))},t.prototype.remove=function(t,e){var n=this._data[t];if(n){var r=n.indexOf(e);-1!==r&&n.splice(r,1)}},t.prototype.execute=function(t,e,n){var r=this._data[t],o=n?function(t){try{n(t)}catch(t){console.error(t)}}:null,i=new ne(r,o);try{i.execute(e)}catch(t){o&&o(t),console.error(t)}},t}(),oe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ie=u.getElementType(O),ae=function(t){function e(e){var n=t.call(this,e)||this;return n.elementType=ie,n}return oe(e,t),e.isElementType=function(t){return u.isElementInstanceOf(t,O)},e.createElement=function(){return ie.create()},e.prototype.isElementMatched=function(n,r){return r?t.prototype.isElementMatched.call(this,n,r):e.isElementType(n)},e}(rt),le=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ce=new w,ue=function(t){function e(e){var n=t.call(this,e)||this;return n.elementType=ce,n}return le(e,t),e.createElement=function(){return ce.create()},e.isElementType=function(t){return u.isElementInstanceOf(t,w)},e.prototype.isElementMatched=function(n,r){return r?t.prototype.isElementMatched.call(this,n,r):e.isElementType(n)},e.prototype.extractContentNodes=function(t,e){return gt(t,e)},e.prototype.isElementType=function(t){return u.isElementInstanceOf(t,w)},e}(ae);function se(t){return Promise.resolve().then(t)}var fe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pe=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function l(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,l)}c((r=r.apply(t,e||[])).next())}))},de=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},he=Array.prototype.slice,me=u.getElementType(N),ye=new j,ge=null,ve=new Set,be=function(t){var e=t-1+97,n=0;return e>122&&(n=e-122,e=122),String.fromCharCode(e)+(n>0?String(n):"")},xe=[function(t){return"".concat(t,".")},function(t){return"(".concat(t,").")},function(t){return"[".concat(t,"].")}],Ce=[function(t){return String(t)},function(t){return be(t).toUpperCase()},be],Ee=function(t,e){void 0===e&&(e=0);var n=e%(Ce.length*xe.length);return(0,xe[n%xe.length])((0,Ce[n/xe.length|0])(t))},Oe=function(t){return pe(void 0,void 0,void 0,(function(){return de(this,(function(e){return t?(ve.add(t),ge?[2,ge]:[2,ge=se((function(){ge=null;var t=Array.from(ve);ve.clear(),t.forEach((function(t){!function(t){for(var e=null==t?void 0:t.firstElementChild,n=[];e;)if(u.isElementInstanceOf(e,N))if(e.hasAttribute("block"))e=e.nextElementSibling;else{var r=e.getAttribute("type")||"ul",o=+(e.getAttribute("level")||0);n.length=o+1;var i=n[+o]||(n[+o]={index:1,type:"ul"});r!==i.type&&(i.index=1),i.type=r;var a=e.children[0];if(!u.isElementInstanceOf(a,j)){var l=ye.create();Ft(a)&&Ot(a,l),e.insertBefore(l,a),a=l}a.textContent="ol"===r?Ee(i.index,o):"",i.index++,e=e.nextElementSibling}else e=e.nextElementSibling,n.length=0}(t)}))}))]):[2,Promise.reject()]}))}))},_e=function(t){if(t){var e=t.startElement,n=t.endElement,r=e.parentElement,o=null==n?void 0:n.parentElement;u.isElementInstanceOf(r,N)&&we.validateElement(r.parentElement),u.isElementInstanceOf(o,N)&&we.validateElement(null==o?void 0:o.parentElement)}},we=function(t){function e(e){var n=t.call(this,e)||this;return n.elementType=me,n}return fe(e,t),e.prototype.getState=function(){var t=this.getRange(),e=this.createState();if(!t.collapsed)return e;var n=t.startElement,r=this.findNearest(n).getAttribute("type");return r&&(e.data={type:r}),e},e.prototype.execute=function(t){var e,n,r=this,o=t||{},i=o.type,l=void 0===i?"ul":i,c=o.indent,s=o.enabled,f=void 0!==s&&s,p=this.getRange();if(p.collapsed){var d=p.startContainer,h=p.startOffset,m=Dt(d,this.getContainer());if(m&&Oe(m).then((function(){var t;null===(t=r.getRange())||void 0===t||t.select()})),f){var y=Vt(d,this.getContainer());if(u.isElementInstanceOf(y,N)){if(c){var g=y.getAttribute("level")||0;y.setAttribute("level",String(+g+1)),p.select()}else{y.getAttribute("type")!==l&&y.setAttribute("type",l)}return}var v=this.createElement();v.setAttribute("type",l);var b=u.isElementInstanceOf(y.parentNode,a);(C=he.call(y.childNodes)).forEach((function(t){v.appendChild(t)})),b?y.appendChild(v):null===(n=y.parentNode)||void 0===n||n.replaceChild(v,y)}else{var x=Vt(d,this.getContainer());if(!u.isElementInstanceOf(x,N))return void p.select();var C=he.call(x.children),E=ae.createElement();C.forEach((function(t){u.isElementInstanceOf(t,j)||E.appendChild(t)})),null===(e=x.parentNode)||void 0===e||e.replaceChild(E,x)}(p=p.new()).startContainer=d,p.startOffset=h,p.select()}else p.select()},e.validateElement=Oe,e.validateRange=_e,e}(ue),Se=we,Ae={type:"backspace",actions:[{execute:function(t,e){var n=e.event,r=e.editor;n.preventDefault(),r.execCommand("backspace"),t.next(e)}},{execute:function(t,e){var n=e.event,r=e.editor.getNormalizedRange();if(Se.validateRange(r),!r.collapsed){var o=r.startElement,i=r.endElement,a=u.isElementInstanceOf(o,N),l=u.isElementInstanceOf(i,N),c=void 0,s=void 0;a&&(c=o.parentElement),l&&(s=i.parentElement);var f=t.next(e),p=null;if(c){var d=c.parentElement;0===c.childElementCount&&(dt(c),p=Rt(d))}if(s){d=s.parentElement;if(0===s.childElementCount){dt(s);var h=Rt(d);p||(p=h)}}return p&&((r=r.new()).startElement=p,r.startOffset=0,r.select()),f}var m=r.startElement,y=r.startOffset,g=r.startContainer,v=m.parentElement;if(Nt(0,m)&&(0===y||yt(g))&&u.isElementInstanceOf(v,N)){var b=Number(v.getAttribute("level"))||0;if(!v.getAttribute("block"))return n.preventDefault(),v.setAttribute("block","1"),void r.select();if(b)return v.setAttribute("level",String(b-1)),v.removeAttribute("block"),n.preventDefault(),void r.select()}t.next(e)},priority:-1e3},{execute:function(t,e){var n=e.event,r=e.editor,o=r.getNormalizedRange();if((!o||o.collapsed)&&!r.cursor.isActive()&&r.execCommand("selectState",{type:"removeSelect"}))return void n.preventDefault();t.next(e)},priority:-9999}]},Te={type:"enter",actions:[{execute:function(t,e){var n=e.editor;e.event.preventDefault(),n.execCommand("enter")}},{execute:function(t,e){t.next(e)},priority:-1e3},{execute:function(t,e){var n=e.event,r=e.editor,o=r.getNormalizedRange();if(o.collapsed&&Ft(o.startElement)){var i=Dt(o.startElement,r.getContainer()),a=i.parentNode;if(u.isElementInstanceOf(a,D))if(i===a.lastElementChild&&Kt(i))return n.preventDefault(),1===a.childElementCount?(dt(i),a.parentNode.replaceChild(i,a)):mt(i,i.parentNode),void o.select()}t.next(e)},priority:-500},{execute:function(t,e){var n,r=e.event,o=e.editor.getNormalizedRange();if(Se.validateRange(o),!o.collapsed)return t.next(e);var i=o.startElement.parentElement;if(u.isElementInstanceOf(i,N)&&i.hasAttribute("block")&&Kt(i)){r.preventDefault();var a=u.createElement(O);return gt(i,a,(function(t){return u.isElementInstanceOf(j)})),null===(n=i.parentNode)||void 0===n||n.replaceChild(a,i),void o.select()}return t.next(e)},priority:-600}]},Ne={type:"tab",actions:[{execute:function(t,e){var n=e.editor;e.event.preventDefault(),n.execCommand("tab")}},{execute:function(t,e){var n=e.editor,r=e.event,o=n.getNormalizedRange();if(o.collapsed){var i=o.startElement,a=o.startOffset;if(u.isElementInstanceOf(i.parentNode,N)&&u.isElementInstanceOf(i,g)&&Nt(i.parentElement,i)&&(0===a||yt(i)))return n.execCommand("list",{indent:!0,enabled:!0}),void r.preventDefault()}t.next(e)},priority:-9999}]},Re={type:"textInput",actions:[{execute:function(t,e){var n=e.event,r=e.editor,o=e.text;n.preventDefault(),r.execCommand("textInput",o)}}]},je={type:"delete",actions:[{execute:function(t,e){var n=e.event,r=e.editor;n.preventDefault(),r.execCommand("delete"),t.next(e)}},{execute:function(t,e){var n=e.event,r=e.editor,o=r.getNormalizedRange();if((!o||o.collapsed)&&!r.cursor.isActive()&&r.execCommand("selectState",{type:"removeSelect"}))return void n.preventDefault();t.next(e)},priority:-9999}]},ke=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Me={text:"text/ky-text",element:"text/ky-element"},Pe=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.commandType=nt,e}return ke(e,t),e.prototype.executeWhileSelectTarget=function(t){var e=this.commandManager,n=e.execCommand("selectState",{type:"getSelect"});if(n){var r=(t||{}).type;return"cut"===(void 0===r?"copy":r)&&e.execCommand("selectState",{type:"removeSelect"}),{type:Me.element,text:"",html:e.editor.parser.stringify(n)}}},e.prototype.execute=function(t){var e=this.getRange();if(null==e?void 0:e.collapsed){var n=this.executeWhileSelectTarget(t);if(n)return n}if(e){for(var r=(t||{}).type,o=void 0===r?"copy":r,i=this.commandManager.editor.parser,a="cut"===o?e.extractContents():e.cloneContents(),l=a.firstChild,c=[],u=a.textContent;l;){if(3===l.nodeType){var s=st();s.textContent=l.textContent||"",c.push(i.stringify(s))}else c.push(i.stringify(l));l=l.nextSibling}return{type:Me.text,text:u,html:c.join("")}}},e.InternalClipboardTypes=Me,e}(rt),Ie=Pe.InternalClipboardTypes,Be=function(t,e){var n,r,o,i={html:e.html},a=JSON.stringify(i);null===(n=t.clipboardData)||void 0===n||n.setData("text/plain",e.text),null===(r=t.clipboardData)||void 0===r||r.setData("text/html",e.text),null===(o=t.clipboardData)||void 0===o||o.setData(e.type,a)},ze=function(t,e){var n=t.target;return!!e.contains(n===document.body?document.activeElement:n)&&!Gt(t,e)},Le={type:"cut",actions:[{execute:function(t,e){var n=e.event,r=e.editor;if(ze(n,r.getWrapper())){n.preventDefault();var o=r.getNormalizedRange();if(Zt(o,r.getContainer())){r.saveLog();var i=r.execCommand("clipboard",{type:"cut"});if(i&&(Be(n,i),se((function(){r.checkUnmountCustomElements()}))),o){var a=r.newRange();a.startContainer=o.startContainer,a.startOffset=o.startOffset,a.select()}t.next(e)}}}}]},Ve={type:"copy",actions:[{execute:function(t,e){var n=e.event,r=e.editor;if(ze(n,r.getWrapper())){n.preventDefault();var o=r.getNormalizedRange();if(Zt(o,r.getContainer())){var i=r.execCommand("clipboard",{type:"copy"});i&&(Be(n,i),t.next(e))}}}}]},De={color:1,"text-decoration":1,"font-weight":1},Ue={address:1,article:1,aside:1,blockquote:1,details:1,p:1,dialog:1,div:1,fieldset:1,figcaption:1,figure:1,footer:1,header:1,nav:1,pre:1,section:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1};var We=function(){function t(){this._elementParsers={}}return t.prototype.registerParser=function(t,e){e.connect(this),this._elementParsers[t]=e},t.prototype.visit=function(t){var e,n=this,r=document.createDocumentFragment();function o(){e=ut(),r.appendChild(e)}var i=function(t){if(1===t.nodeType||3===t.nodeType)if(u.isValidElement(t))u.isElementInstanceOf(t,A)?r.appendChild(t):(e||o(),e.appendChild(t));else if(1===t.nodeType){var a=t;if(!function(t){var e=String(t.tagName).toLowerCase(),n=_t(t.getAttribute("style"));return!(!n||"block"!==n.display&&"flex"!==n.display)||(!(!Ue[e]||n.display)||void 0)}(a)){var l=n.extractParagraphElements(a);return e||o(),void e.appendChild(l)}e&&Rt(e),o();var c=_t(a.getAttribute("style")).toString();c&&e.setAttribute("style",c);for(var s=a.firstChild;s;){var f=s.nextSibling;i(s),s=f}}else{e||o();var p=t.textContent;if(p){var d=st(p);e.appendChild(d)}}};if(1===t.nodeType&&"body"===t.tagName.toLowerCase())for(var a=t.firstChild;a;){var l=a.nextSibling;i(a),a=l}else i(t);return r},t.prototype.extractParagraphElements=function(t){var e=document.createDocumentFragment(),n=this._elementParsers,r=function(t){if(1!==t.nodeType&&t.textContent){var o=function(t){var e=t.getAttribute("style");if(e)return e=_t(e,De)}(t.parentNode),i=st(t.textContent),a=null==o?void 0:o.toString();return a&&i.setAttribute("style",a),void e.appendChild(i)}var l=t,c=String(l.tagName).toLowerCase(),s=n[c];if(s){var f=s.parse(l);if(f){var p=Ft(f);!p&&Ft(e.lastElementChild)&&e.appendChild(u.createElement(g)),e.appendChild(f),p||e.appendChild(u.createElement(g))}}else for(var d=l.firstChild;d;)r(d),d=d.nextSibling};return r(t),e},t}(),He=function(){function t(){}return t.prototype.parse=function(t){},t.prototype.connect=function(t){this.parserVisitor=t},t}(),Fe=Object(ct.h)("ky-editor"),qe=Fe.prefixName,Ze=Fe.prefixClassName,Ke=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var Je=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ke(e,t),e.prototype.parse=function(t){var e=document.createDocumentFragment();e.appendChild(function(t){var e=t.src,n=t.title,r=u.createElement(W);r.setAttribute("type","ky-image"),r.setAttribute("src",e),r.setAttribute("title",n),r.className=Ze("image");var o=u.createElement(m);return o.appendChild(r),o.style.width="100px",o.style.height="100px",o}(t));var n=st();return e.appendChild(n),e},e}(He),Xe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var Ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Xe(e,t),e.prototype.parse=function(t){for(var e=function(t){var e=u.createElement(C);return["href","_blank","title"].forEach((function(n){var r=t.getAttribute(n);r&&e.setAttribute(n,r)})),e}(t),n=t.firstChild;n;){var r=n.nextSibling;e.appendChild(this.parserVisitor.extractParagraphElements(n)),n=r}return e},e}(He),Ye=(n(229),function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Qe=Array.prototype.slice;function $e(){var t=document.createElement("td"),e=jt(),n=Pt(e);return t.appendChild(e),{element:t,textElement:n}}function tn(t){for(var e=null,n=document.createElement("tr"),r=0;r<t;r++){var o=$e(),i=o.element,a=o.textElement;i.setAttribute("index",String(r)),e||(e=a),n.appendChild(i)}return{tr:n,firstTextElement:e}}var en=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-table-resize-marker",e.outputDisabled=!0,e}return Ye(e,t),e.prototype.create=function(){var e=t.prototype.create.call(this),n=document.createElement("i");return e.appendChild(n),e},e.tagName="ky-table-resize-marker",e}(o);function nn(t){var e=t.firstElementChild,n=e.firstElementChild,r=n.nextElementSibling;return{table:e,colgroup:n,tbody:r,getCols:function(){return Qe.call(n.children)},getRows:function(){return Qe.call(r.children)}}}function rn(t,e){var n=String(t.style.width||"");return n.endsWith("%")?parseFloat(n.substring(0,n.length-1))/100*e:parseFloat(n)}var on,an=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-table",e}return Ye(e,t),e.prototype.create=function(e){var n=e||{},r=n.cols,o=void 0===r?5:r,i=n.rows,a=void 0===i?5:i,l=t.prototype.create.call(this),c=document.createElement("table"),u=100/o,s=document.createElement("colgroup");c.appendChild(s);for(var f=0,p=0;p<o;p++){var d=p===o-1?100-f:u;f+=u;var h=document.createElement("col");h.style.width="".concat(d,"%"),s.appendChild(h)}for(var m=document.createElement("tbody"),y=0;y<a;y++){var g=tn(o).tr;g.setAttribute("index",String(y)),m.appendChild(g)}return c.appendChild(m),l.appendChild(c),l},e.tagName="ky-table",e.getElementModel=nn,e.getColWidth=rn,e}(o),ln=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),cn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ln(e,t),e.prototype.parse=function(t){var e,n=t.querySelector("colgroup"),r=n?n.children:null,o=t.querySelector("tbody");e=o?o.children:t.querySelectorAll("tr");var i=document.createElement("colgroup"),a=0;if(r)for(f=0;f<r.length;f++){var l=r[f];d=document.createElement("col");i.appendChild(d);var c=l.getAttribute("width");h=Ct();if(c)h.width="".concat(parseInt(c),"px");else{p=_t(d.getAttribute("style"));h.width=p.width}a+=parseInt(h.width),d.setAttribute("style",h)}else for(var s=(x=e[0]).querySelectorAll("td"),f=0;f<s.length;f++){var p=_t((C=s[f]).getAttribute("style")),d=document.createElement("col");i.appendChild(d);var h=Ct();p.width?h.width=p.width:h.width="100px",a+=parseInt(h.width),d.setAttribute("style",h)}var m=document.createElement(an.tagName),y=document.createElement("table");y.appendChild(i);var g=document.createElement("tbody");y.appendChild(g);var v=Ct();v.width="".concat(a,"px"),y.setAttribute("style",v);for(var b=0;b<e.length;b++){var x;s=e[b].children;(x=document.createElement("tr")).setAttribute("index",String(b)),g.appendChild(x);for(f=0;f<s.length;f++){var C,E=s[f],O=E.getAttribute("rowspan"),_=E.getAttribute("colspan");if((C=document.createElement("td")).setAttribute("index",String(f)),O&&C.setAttribute("rowspan",O),_&&C.setAttribute("colspan",_),E.firstChild){S=u.createContainer();var w=this.parserVisitor.visit(E);S.appendChild(w),ht(C),C.appendChild(S)}else{var S=u.createContainer(),A=ut(),T=st();A.appendChild(T),S.appendChild(A),ht(C),C.appendChild(S)}x.appendChild(C)}}m.appendChild(y);var N=u.createElement(W,{type:"table",innerHTML:!0});return N.appendChild(m),N},e}(He),un=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),sn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return un(e,t),e.prototype.parse=function(t){var e=st(t.textContent||"");return e.setAttribute("b","1"),e},e}(He),fn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),pn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return fn(e,t),e.prototype.parse=function(t){return document.createElement("br")},e}(He),dn=function(){function t(){this.parserVisitor=new We,this.registerParser()}return t.prototype.registerParser=function(){var t=this.parserVisitor;t.registerParser("img",new Je),t.registerParser("a",new Ge),t.registerParser("table",new cn),t.registerParser("strong",new sn),t.registerParser("br",new pn)},t.prototype.parse=function(t){var e=this.parserVisitor,n=(new DOMParser).parseFromString(t,"text/html");return e.visit(n.body)},t}(),hn=function(){return(hn=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};var mn,yn=new dn,gn={execute:function(t,e){var n=e;t.editor.execCommand("textInput",n)}},vn=function(t,e){var n=yn.parse(e),r=t.event,o=t.editor,i=o.getNormalizedRange(),a=n.firstElementChild;if(a){var l=Fi.getElementsByElementType(n,W);se((function(){l.forEach((function(t){o.mountCustomElement(t)}))}));var c=Lt(a),s=t.pasteElements=[];if(a){dt(a);for(var f=a.firstElementChild,p=void 0;f;){var d=f.nextElementSibling;s.push(f),p?mt(f,p):o.commandManager.execCommand("input",{element:f,offset:i.startOffset,endOffset:i.startOffset}),p=f,f=d}}var h=i.new();h.startElement=c,h.startOffset=null==c?void 0:c.textContent.length,h.select(),n.firstElementChild&&o.actionManager.execute("enter",{editor:o,event:r});var m=function(t,e){for(;t&&t!==e&&!u.isElementInstanceOf(t,O);)t=t.parentNode;if(u.isElementInstanceOf(t,O))return t}(o.getNormalizedRange().startElement,o.getContainer()),y=n.lastElementChild;if(y)return m.parentNode.insertBefore(n,m),c=Lt(y),h.startElement=c,h.startOffset=null==c?void 0:c.textContent.length,h.select(),s}},bn={execute:function(t,e){var n=JSON.parse(e);return vn(t,n.html)}},xn={execute:function(t,e){var n=t.editor,r=JSON.parse(e);mn||(mn=document.createElement("div")),mn.innerHTML=r.html;var o=Array.prototype.slice.call(mn.children),i=mn.firstElementChild;if(i){ht(mn);var a=n.getNormalizedRange();return n.commandManager.execCommand("input",{element:i,offset:a.startOffset,endOffset:a.startOffset}),n.mountCustomElement(i.firstElementChild),o}}},Cn=((on={})[Ie.text]=bn,on[Ie.element]=xn,on["text/plain"]=gn,on),En=[Ae,Ne,Te,Re,je,Le,Ve,{type:"paste",actions:[{execute:function(t,e){var n=e.event,r=e.editor;if(r.selectionEnabled()){n.preventDefault();var o=n.clipboardData,i=o.types,a=Object.keys(Cn).find((function(t){return i.indexOf(t)>=0}))||"text/plain";r.saveLog();var l=o.getData(a);if(l){var c=Cn[a]||gn;e=hn({},e),c.execute(e,l)}r.checkUnmountCustomElements(),t.next(e)}}},{priotity:1,execute:function(t,e){var n=e.pasteElements;null==n||n.forEach((function(t){(u.isElementInstanceOf(t,N)||Fi.getElementsByElementType(t,N))&&Se.validateElement(t.parentElement)})),t.next(e)}}]}];var On={apply:function(t){t.onNative("focus",(function(t){})),t.onNative("blur",(function(t){}))}};var _n={apply:function(t){var e,n=function(){var n=t.editor.saveRangeContext();if(!n)return t.editor.selectionEnabled(!1),void t.emit("selectionLost");t.editor.selectionEnabled(!0),t.emit("selectionGet");var r,o,i=(o=n,!(!(r=e)&&o||r&&!o)&&(!r&&!o||["startContainer","endContainer"].every((function(t){return r[t]===o[t]}))));i||(e=n,t.emit("selectionElementsChange")),i&&function(t,e){return!(!t&&e||t&&!e)&&(!t&&!e||["startOffset","endOffset"].every((function(n){return t[n]===e[n]})))}(e,n)||t.emit("selectionchange")};t.on("internalSelectionchange",n),document.addEventListener("selectionchange",(function(){t.emit("internalSelectionchange")})),t.on("unmount",(function(){document.removeEventListener("selectionchange",n)}))}};n(230);var wn={apply:function(t){function e(){t.editor.saveLog()}var n=qe("select-none"),r=ct.e.create(),o=null,i=!1,a={container:t.editor.getContainer(),overlay:!0,syncElementResize:!0,overlayVertex:!0,autoDestroyEventManager:!0,modes:[function(t){var e=t.type,n=c();if(!n)return!1;var r=n.getAttribute("resize-modes");return!r||-1!==r.indexOf(e)}],onResizeStart:function(e){e.stopPropagation(),t.editor.getContainer().setAttribute(n,"")},onBeforeResize:function(t){i||(e(),i=!0)},onResize:function(){l(!1)},onResizeEnd:function(e,r){var a=r.modes;l(!0),o=e.resizeElement,t.editor.getContainer().removeAttribute(n),i=!1;var c=o.firstElementChild;c&&((a.Top||a.Bottom)&&(c.style.height="100%"),(a.Left||a.Right)&&(c.style.width="100%")),se((function(){s(o)}))}};function l(e){t.editor.execCommand("selectState",{type:"setVisible",visible:e})}function c(){return t.editor.execCommand("selectState",{type:"getSelect"})}function s(e){e&&(t.editor.execCommand("selectState",{type:"select",element:e}),t.emit("selectStateChange",t.editor,[e]),o=null)}t.register("click:behaviorClick",(function(e){var n=ct.a.findUpUtil(e.target,(function(t){if(u.isElementInstanceOf(t,m))return!!t}),(function(e){return e===t.getProxyElement()}));return n||(o||(t.editor.execCommand("selectState",{type:"cancelSelect"}),void t.emit("selectStateChange",t.editor,[null])))})),t.on("behaviorClick",(function(t){s(t.target)})),r.apply((function(){return c()}),a);var f={logged:!1},p={onRotateStart:function(t){var e=c();o=e,f.logged=!1},onRotate:function(t,n){var r=n.angle;f.logged||(e(),f.logged=!0);var o=c(),i=ct.a.getTransformMatrix(o);i=i.rotate(r),o.style.transform="".concat(i)},center:function(t,e){var n=e.parentElement.querySelector(G.tagName).getBoundingClientRect();return{x:n.x,y:n.y}}};ct.f.mount({container:t.editor.getContainer(),getOptions:function(t,e){if(u.isElementInstanceOf(e,J))return p}})}};var Sn={apply:function(t){var e=null,n=new MutationObserver((function(n){for(var r=!1,o=0,i=n;o<i.length;o++){if("attributes"!==i[o].type){r=!0;break}}r&&t.emit("nodeChange",null,[t.editor]),e||(e=se((function(){e=null,t.emit("change",null,[t.editor])})))}));t.on("didMount",(function(){var e=t.editor.getContainer();n.observe(e,{attributes:!0,childList:!0,subtree:!0})})),t.on("willDestroy",(function(){n.disconnect()}))}};var An={apply:function(t){t.on("change",(function(t){}))}};var Tn={apply:function(t){t.register("keydown:shortcutKey",(function(t){if(ct.d.assKeys.some((function(e){return t[e]})))return t.target})),t.on("shortcutKey",(function(e){t.emitShortcutEvent(e)}))}};var Nn={apply:function(t){t.onNative("paste",(function(e){t.editor.actionManager.execute("paste",{event:e,editor:t.editor})}))}};var Rn={apply:function(t){var e=function(e){t.editor.actionManager.execute("cut",{editor:t.editor,event:e})};document.body.addEventListener("cut",e),t.on("unmount",(function(){document.body.removeEventListener("cut",e)}))}};var jn={apply:function(t){var e=function(e){t.editor.actionManager.execute("copy",{editor:t.editor,event:e})};document.body.addEventListener("copy",e),t.on("unmount",(function(){document.body.removeEventListener("copy",e)}))}},kn=function(t){var e=t.events;e.registerShortcutHandler("Ctrl+Z|Meta+Z",(function(){t.execCommand("log","cancel")})),e.registerShortcutHandler("Ctrl+B|Meta+B",(function(){t.execCommand("bold")})),e.registerShortcutHandler("Ctrl+I|Meta+I",(function(){t.execCommand("italic")}))},Mn=qe("checked");var Pn={apply:function(t){t.register("click:toggleCheckbox",(function(e){return ct.a.findUpUtil(e.target,(function(t){if(u.isElementInstanceOf(t,z))return!!t}),(function(e){return e===t.getProxyElement()}))})),t.on("toggleCheckbox",(function(t){var e,n=t.target;(e=n).hasAttribute(Mn)?e.removeAttribute(Mn):e.setAttribute(Mn,"")}))}};function In(t){var e,n=!1;return function(){return n||(e=t(),n=!0),e}}function Bn(t){return(new DOMParser).parseFromString(t,"text/html").body.firstElementChild}function zn(t,e){return Object.assign(t.style,{position:"absolute",cursor:"pointer",width:"25px",height:"25px",zIndex:2},e||{}),t}var Ln={apply:function(t){var e=null,n=null,r=function(){var e=document.createElement("div");Object.assign(e.style,{position:"fixed",left:"0px",top:"0px",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.92)",userSelect:"none",cursor:"pointer",zIndex:1e3});var r=document.createElement("div"),o=function(t){r.style.transform="translate3d(".concat(t.tx,"px,").concat(t.ty,"px,0) scale(").concat(t.scale||1,")")},i=function(){var t={tx:0,ty:0,scale:1};d.syncZoomState(t),o(t)},a=function(t){n=t,f.src=t.src,document.body.appendChild(e)},l=zn(Bn('<svg viewBox="0 0 1024 1024"  xmlns="http://www.w3.org/2000/svg"><path d="M546.942134 511.818772l327.456957-326.128977c9.617355-9.577423 9.648071-25.135361 0.070648-34.751692-9.577423-9.617355-25.137409-9.647048-34.750668-0.070648L512.119795 477.137729 184.520518 150.868479c-9.616331-9.577423-25.176316-9.545683-34.751692 0.070648-9.577423 9.616331-9.545683 25.174268 0.070648 34.751692l327.457981 326.127953-327.457981 326.128978c-9.616331 9.577423-9.647048 25.135361-0.070648 34.751692a24.496456 24.496456 0 0 0 17.41117 7.231702 24.500552 24.500552 0 0 0 17.340522-7.162078L512.119795 546.499816l327.599276 326.26925a24.492361 24.492361 0 0 0 17.340522 7.162078 24.5026 24.5026 0 0 0 17.41117-7.231702c9.577423-9.617355 9.545683-25.175292-0.070648-34.751692L546.942134 511.818772z" fill="#ffffff"></path></svg>'),{right:"20px",top:"20px"});e.appendChild(l);var c=zn(Bn('<svg viewBox="0 0 1024 1024"  xmlns="http://www.w3.org/2000/svg"><path d="M784.652701 955.6957 346.601985 517.644983c-2.822492-2.822492-2.822492-7.902977 0-11.289967l439.179713-439.179713c6.77398-6.77398 10.725469-16.370452 10.725469-25.966924L796.507166 36.692393c0-20.32194-16.370452-36.692393-36.692393-36.692393l-4.515987 0c-9.596472 0-19.192944 3.951488-25.966924 10.725469L250.072767 489.420066c-12.418964 12.418964-12.418964 32.740904 0 45.159868l477.565601 477.565601c7.338479 7.338479 17.499449 11.854465 28.224917 11.854465l0 0c22.015436 0 40.079383-18.063947 40.079383-40.079383l0 0C796.507166 973.759647 791.99118 963.598677 784.652701 955.6957z" fill="#ffffff"></path></svg>'),{left:"0px",top:"50%",marginTop:"-10px"});c.addEventListener("click",(function(){var e=zt(n,(function(t){return"ky-image"===t.getAttribute("type")}),(function(e){return e===t.editor.getContainer()}));if(e){i();var r=e.querySelector("img");r&&a(r)}})),e.appendChild(c);var u=zn(Bn('<svg viewBox="0 0 1024 1024"  xmlns="http://www.w3.org/2000/svg"><path d="M246.121279 955.6957l438.050717-438.050717c2.822492-2.822492 2.822492-7.902977 0-11.289967L244.992282 67.175303c-6.77398-6.77398-10.725469-16.370452-10.725469-25.966924L234.266814 36.692393C234.266814 16.370452 250.637266 0 270.959206 0l4.515987 0c9.596472 0 19.192944 3.951488 25.966924 10.725469l478.694598 478.694598c12.418964 12.418964 12.418964 32.740904 0 45.159868l-477.565601 477.565601c-7.338479 7.338479-17.499449 11.854465-28.224917 11.854465l0 0c-22.015436 0-40.079383-18.063947-40.079383-40.079383l0 0C234.266814 973.759647 238.7828 963.598677 246.121279 955.6957z" fill="#ffffff"></path></svg>'),{right:"0px",top:"50%",marginTop:"-10px"});u.addEventListener("click",(function(){var e=Bt(n,(function(t){return"ky-image"===t.getAttribute("type")}),(function(e){return e===t.editor.getContainer()}));if(e){i();var r=e.querySelector("img");r&&a(r)}})),e.appendChild(u);var s=function(){dt(e)};l.addEventListener("click",s),Object.assign(r.style,{width:"100%",height:"100%",display:"flex",transformOrigin:"0 0",alignItems:"center",justifyContent:"center"});var f=new Image;Object.assign(f.style,{maxWidth:"80%",maxHeight:"80%"}),r.appendChild(f),e.appendChild(r);var p=function(t){return!!ct.a.findUpUtil(t.target,(function(t){return t===f}),(function(t){return t===e}))},d=ct.g.create({maxZoom:100,zoomElement:r,dragEnabled:p,scaleEnabled:p,onZoomDragStart:function(t){t.native.preventDefault()},onZoomScale:function(t,e){o(e)},onZoomDragMove:function(t,e){o(e)}});return d.mount(e),{zoomInstance:d,element:e,show:a,close:s,reset:i}};t.register("click:imageClick",(function(e){return ct.a.findUpUtil(e.target,(function(t){return"ky-image"===t.getAttribute("type")}),(function(e){return e===t.getProxyElement()}))})),t.on("imageClick",(function(n){var o=n.target;if(!t.editor.isEditMode()||o.nextElementSibling){var i=o.querySelector("img");i&&function(t){e||(e=r()),e.reset(),e.show(t)}(i)}})),t.on("willDestroy",(function(){e&&e.close()}))}};n(231);var Vn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Dn=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tagName="ky-cursor",e}return Vn(e,t),e.tagName="ky-cursor",e}(o),Un=(n(232),function(){return(Un=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)}),Wn=Array.prototype.slice;function Hn(t,e){var n=document.createRange();return 1===arguments.length?(n.selectNode(t),n):(n.setStart(t,e),n)}function Fn(t,e,n,r){for(var o,i=function(t,e,n,r){if(n-e<2)return e;var o=(n+e)/2|0,a=Hn(t,o).getBoundingClientRect();return a.y+a.height<r.y?i(t,o,n,r):i(t,e,o,r)},a=i(t,e,n,r);a>0;){var l=Hn(t,a).getBoundingClientRect();if(o||(o=l),l.x<r.x||l.x>o.x)break;a--}return a}function qn(t,e,n,r){for(var o,i=function(t,e,n,r){if(n-e<2)return n;var o=(n+e)/2|0;return Hn(t,o).getBoundingClientRect().y>r.y?i(t,e,o,r):i(t,o,n,r)},a=i(t,e,n,r);a<n;){var l=Hn(t,a).getBoundingClientRect();if(o||(o=l),l.x>r.x||l.x<o.x)break;a++}return a}function Zn(t,e){if(!e){var n=t.lastChild;if(!t.textContent)return Hn(t);for(;n;){if(3===n.nodeType)return Hn(n,n.textContent.length);n=n.previousSibling}return Hn(t)}if(!function(t,e){return Kn(t.x,e.x,e.x+e.width)&&Kn(t.y,e.y,e.y+e.height)}(e,t.getBoundingClientRect()))return null;console.time("getTextCursorRange");try{return function(t,e){for(var n={last:{bounding:null,range:null},nearest:{bounding:null,range:null,dx:1e4}},r=t.firstChild;r;)if(3===r.nodeType){var o=r.textContent.length,i=Hn(r,0).getBoundingClientRect(),a=Hn(r,o).getBoundingClientRect();if(e.y<i.y||e.y>a.y+a.height)r=r.nextSibling;else{for(var l=Fn(r,0,o,e),c=qn(r,l,o,e),u=l;u<=c;u++){var s=Hn(r,u),f=s.getBoundingClientRect(),p=f.x>=e.x,d=Math.abs(f.x-e.x),h=n.nearest;if((!h.range||h.dx>d)&&(h.bounding=f,h.range=s,h.dx=d),p&&Kn(e.y,f.y,f.y+f.height)){var m=n.last.bounding;if(m){var y=m.x;Kn(e.y,m.y,m.y+m.height)||(y=i.x);var g=f.x-y;if(f.x-e.x<.5*g)return s}return n.last.range||s}n.last.bounding=f,n.last.range=s}r=r.nextSibling}}else r=r.nextSibling;if(!n.nearest.range)return n.nearest.range;if(n.nearest.range&&n.last.range){var v=n.last.bounding,b=n.nearest.bounding;return Math.abs(v.y-e.y)>Math.abs(b.y-e.y)&&n.nearest.range||n.last.range}return n.last.range}(t,e)}finally{console.timeEnd("getTextCursorRange")}}function Kn(t,e,n){return t>=e&&t<=n}function Jn(t){return t.y+t.height/2}var Xn=function(t,e,n){if(void 0===n&&(n=0),!(t.lineIndex>2)){var r=t.last,o=function(e){var n=e.getBoundingClientRect();if(r.range||(r.bounding=n,r.range=e),t.currentRange||(t.currentRange=e,t.currentBounding=n),(n.x<r.bounding.x||n.x===r.bounding.x&&Jn(n)>function(t){return t.y+t.height}(r.bounding)&&n!==t.currentBounding)&&t.lineIndex++,t.lineIndex>=2)return!0;if(t.lineIndex>0)if(t.range){var o=Math.abs(n.x-t.currentBounding.x);o<=t.dx&&(t.range=e,t.bounding=n,t.dx=o)}else t.range=e,t.bounding=n,t.dx=Math.abs(n.x-t.currentBounding.x);r.bounding=n,r.range=e};if(1!==e.nodeType||e.textContent)for(var i=3===e.nodeType?e:e.firstChild;i;)if(3===i.nodeType){for(var a=i.textContent.length,l=n;l<=a;l++){if(o(Hn(i,l)))break}i=i.nextSibling}else i=i.nextSibling;else o(Hn(e))}},Gn=function(t,e,n){if(!(t.lineIndex>2)){var r=t.last,o=function(e){var n=e.getBoundingClientRect();if(r.range||(r.bounding=n,r.range=e),t.currentRange||(t.currentRange=e,t.currentBounding=n),(n.x>r.bounding.x||n.x===r.bounding.x&&Jn(n)<r.bounding.y&&n!==t.currentBounding)&&t.lineIndex++,t.lineIndex>=2)return!0;if(t.lineIndex>0)if(t.range){var o=Math.abs(n.x-t.currentBounding.x);o<=t.dx&&(t.range=e,t.bounding=n,t.dx=o)}else t.range=e,t.bounding=n,t.dx=Math.abs(n.x-t.currentBounding.x);r.bounding=n,r.range=e};if(1!==e.nodeType||e.textContent){var i=3===e.nodeType?e:e.lastChild;for(2===arguments.length&&(n=i?i.textContent.length:0);i;)if(3===i.nodeType){for(var a=n;a>=0;a--){var l=Hn(i,a);if(o(l))break}i=i.previousSibling}else i=i.previousSibling}else o(Hn(e))}};function Yn(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=1);var o={last:{range:null,bounding:null},lineIndex:0,currentRange:null,currentBounding:null,range:null,bounding:null,dx:1e3,isFinish:function(){return o.lineIndex>=2}},i=1===r?Xn:Gn;return i(o,e,n),o.isFinish()?o.range:((1===r?Bt:zt)(e,(function(t){return!(!Ft(t)||(i(o,t),!o.isFinish()))}),t),o.range||o.currentRange)}function Qn(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function $n(t,e){if(Ft(t))return Zn(t,e);var n=Lt(t);if(n){var r=n.firstChild,o=void 0;if(o=r&&r.textContent?Hn(r,r.textContent.length).getBoundingClientRect():Hn(n).getBoundingClientRect(),e.x>o.x&&e.y>o.y)return Zn(n)}var i=Number.NaN,a=[],l=null,c=function(){a.length>=3&&a.shift(),l={items:[]},a.push(l)};c();var u=!1,s=!1,f=function(t){if(!u)for(var n=t.firstElementChild;!u&&n;)if(Jt(n))n=n.nextElementSibling;else{if(Ft(n)){var r=n.firstChild;if(r&&r.textContent){var o=Hn(r).getClientRects();if(o.length>1)s&&(u=!0),c();else if(o.length>0){if((a=o[0]).x<i){if(s){u=!0;break}c()}}if(l.items.push({rects:Wn.call(o),element:n}),o.length>0){var a=o[o.length-1];i=a.x+a.width,a.y+a.height>e.y&&(s=!0)}}else{var p=Hn(n).getBoundingClientRect(),d=p;if(p.x<i){if(s){u=!0;break}c()}i=p.x,l.items.push({rects:[p],element:n}),d.y+d.height>e.y&&(s=!0)}}else if(f(n),u)break;n=n.nextElementSibling}};f(t);var p=null,d=Number.MAX_VALUE,h={maxX:Number.MIN_VALUE,minY:Number.MAX_VALUE};a.forEach((function(t,n){t.items.forEach((function(t){t.rects.forEach((function(r){var o=function(t,e){var n=t.x,r=t.y;return e.y>r+t.height/2&&(r+=t.height),Kn(e.x,n,n+t.width)?Math.abs(e.y-r):e.x<t.x?Qn({x:t.x,y:t.y},e):Qn({x:t.x+t.width,y:t.y},e)}(r,e);o<d&&(p={target:t,element:t.element,bounding:r},d=o),n===a.length-1&&(r.y<h.minY&&(h.minY=r.y),r.x+r.width>h.maxX&&(h.maxX=r.x+r.width))}))}))}));var m=null;if(p){o=p.bounding;var y=p.element;if(0===o.width)m=Zn(y);else{var g=Un({},e);e.x<o.x?g.x=o.x:e.x>o.x+o.width&&(g.x=o.x+o.width),(e.y<o.y||e.y>o.y+o.height)&&(g.y=o.y+o.height/2),m=Zn(y,g)}}return m||n&&(m=Zn(n)),m}var tr={apply:function(t){var e=t.editor,n=t.editor.events,r=null,o=0,i=!1;n.onNative("mousedown",(function(t){r=ct.a.getPosition(t);var e=(new Date).getTime();i=!!(o&&e-o<300),o=e})),n.onNative("mouseup",(function(o){if(!i){var l=ct.a.getPosition(o);if(r){var c=Math.pow(r.x-l.x,2)+Math.pow(r.y-l.y,2);if((c=Math.sqrt(c))>=3)return t.update(null),void(r=null)}var u=o.target;if(ct.a.findUpUtil(u,(function(t){return Jt(t)}),(function(t){return t===e.getContainer()})))t.update(null);else{console.time("cursor");var s=e.getContainer().querySelector(a.tagName);if(s){var f=s.getBoundingClientRect();l.x<=f.left&&(l.x=f.left+2)}var p=$n(u,l);console.timeEnd("cursor"),p&&(t.update(p),n.emit("internalSelectionchange",null,[])),r=null}}}));var l=function(){t.updatePosition()};n.onNative("scroll",l),n.onNative("wheel",l),n.registerShortcutHandler("Ctrl+A|Meta+A",(function(){var n=e.getContainer(),r=e.newRange();r.startElement=Pt(n),r.startOffset=0;var o=kt(n,(function(t){return qt(t)}));if(Ht(o)){var i=o&&o.lastChild;i?(r.endContainer=i,r.endOffset=i.textContent.length):(r.endContainer=o,r.endOffset=0)}else o&&(r.endContainer=o,r.endOffset=0);t.update(null),r.select(),n.focus()}))}},er={Enter:13,Delete:46,Backspace:8,Tab:9,ArrowLeft:37,ArrowTop:38,ArrowRight:39,ArrowBottom:40},nr="Enter",rr="Delete",or="Backspace",ir="Tab";var ar={apply:function(t){var e,n,r=t.editor.events,o={composition:0,logged:!1},i=r.editor,a=((e={})[er.ArrowLeft]=!0,e[er.ArrowRight]=!0,e[er.ArrowTop]=!0,e[er.ArrowBottom]=!0,e);function l(){return r.editor.selectionEnabled()}function c(t,e){i.checkUnmountCustomElements();var n=r.createEvent(t);n.optType=e,function(t){r.emit("keyboardInput",null,[t])}(n)}function u(){r.emit("internalSelectionchange",null,[])}function s(t){var e=i.getNormalizedRange();if(!e)return null;if(t){if(!Ft(e.startElement))return null}else if(!Ft(e.endElement))return null;return e}var f=((n={})[er.ArrowLeft]=function(e){var n;e.preventDefault();var r=Ft(null===(n=i.getNormalizedRange())||void 0===n?void 0:n.startElement)?null:i.execCommand("selectState",{type:"getSelect"});if(r){var o=zt(r,(function(t){return Ft(t)}),(function(t){return t===i.getContainer()||Jt(t)}));if(o)return i.execCommand("selectState",{type:"cancelSelect"}),(a=i.newRange()).startElement=o,a.startOffset=0,void a.select()}if(t.isActive())t.moveLeft();else{var a;if(!(a=s()))return;var l=i.newRange();l.startContainer=a.startContainer,l.startOffset=a.startOffset,l.select()}u()},n[er.ArrowTop]=function(e){if(e.preventDefault(),t.isActive())t.moveTop();else{var n=s();if(!n)return;var r=i.newRange();r.startContainer=n.startContainer,r.startOffset=n.startOffset,r.select()}u()},n[er.ArrowRight]=function(e){var n;e.preventDefault();var r=Ft(null===(n=i.getNormalizedRange())||void 0===n?void 0:n.startElement)?null:i.execCommand("selectState",{type:"getSelect"});if(r){var o=Bt(r,(function(t){return Ft(t)}),(function(t){return t===i.getContainer()||Jt(t)}));if(o){if(i.execCommand("selectState",{type:"cancelSelect"}),!(a=i.newRange()))return;return a.startElement=o,a.startOffset=0,void a.select()}}if(t.isActive())t.moveRight();else{var a;if(!(a=s(!0)))return;var l=i.newRange();l.startContainer=a.endContainer,l.startOffset=a.endOffset,l.select()}u()},n[er.ArrowBottom]=function(e){if(e.preventDefault(),t.isActive())t.moveBottom();else{var n=s(!0);if(!n)return;var r=i.newRange();r.startContainer=n.endContainer,r.startOffset=n.endOffset,r.select()}u()},n[er.Enter]=function(t){i.execute((function(){i.actionManager.execute("enter",{editor:i,event:t})})),c(t,nr)},n[er.Delete]=function(t){i.execute((function(){i.actionManager.execute("delete",{editor:i,event:t})})),c(t,rr)},n[er.Backspace]=function(t){i.execute((function(){i.actionManager.execute("backspace",{editor:i,event:t})})),c(t,or)},n[er.Tab]=function(t){i.execute((function(){i.actionManager.execute("tab",{editor:i,event:t})})),c(t,ir)},n);function p(t,e){se((function(){r.emit("textInput",null,[{text:e}])}))}function d(t,e){e&&(i.actionManager.execute("textInput",{editor:i,event:t,text:e}),i.checkUnmountCustomElements())}r.onNative("keydown",(function(t){if(!function(t){return ct.d.assKeys.some((function(e){return t[e]}))}(t)&&(l()||function(t){return[er.Backspace,er.Delete,er.ArrowLeft,er.ArrowRight].indexOf(t.keyCode)>=0&&!Gt(t,r.editor.getContainer())}(t))){o.logged||(o.logged=!0,a[t.keyCode]||i.saveLog());var e=f[t.keyCode];e&&e(t)}})),t.input.addEventListener("input",(function(e){if(!o.composition){var n=t.input.value;t.input.value="",d(e,n),p(0,n)}})),r.onNative("keyup",(function(){o.composition||(o.logged=!1)}));var h=null;t.input.addEventListener("compositionstart",(function(){l()&&(o.composition=1)}));var m=function(t){var e=i.getNormalizedRange(),n=t.data;if(e.startElement===h.startElement){var r=e.startContainer,o=h.startOffset,a=e.startOffset,l=r.textContent||"",c=l.slice(0,o)+n;r.textContent=c+l.slice(a),(e=i.newRange()).startContainer=r,e.startOffset=c.length,e.select()}else{var u=e.startElement;u.textContent=n,(e=i.newRange()).startElement=u,e.startOffset=n.length,e.select()}};t.input.addEventListener("compositionupdate",(function(t){if(l()){var e=t.data;if(!h)return yt((h=i.getNormalizedRange()).startContainer.textContent)&&(h.startOffset=0),void d(t,e);m(t)}})),t.input.addEventListener("compositionend",(function(e){var n=e;m(n),p(0,n.data),o.logged=!1,o.composition=0,h=null,l()&&(t.input.value="")}))}};function lr(t){if(t){var e=t.startContainer,n=t.startOffset,r={startContainer:e,startOffset:n};return 1===e.nodeType&&(r.anchorNode=e.childNodes[n]),r}}var cr=window.setTimeout,ur=window.clearTimeout,sr=function(){function t(t){this._blinkId=0,this._currentBounding={x:0,y:0,height:0},this.editor=t,this.initElements(),this.initEvents()}return t.prototype.initElements=function(){var t=this;this.element||(this.input=document.createElement("textarea"),this.element=u.createElement(Dn),this.element.appendChild(this.input),this.input.addEventListener("blur",(function(){t.update(null)})),this.update())},t.prototype.initEvents=function(){tr.apply(this),ar.apply(this)},t.prototype.syncScroll=function(t){t.dy&&this.editor.scrollTop(this.editor.scrollTop()+t.dy)},t.prototype.updatePosition=function(){if(this.element&&this.element.parentElement){var t=this.getCursorBounds();this._currentBounding=t,Object.assign(this.element.style,{left:"".concat(t.x,"px"),top:"".concat(t.y,"px")})}},t.prototype.updateBlink=function(t){var e=this;this.clearBlink();var n=!0,r=!1,o=function(){if(e.element&&e.element.parentElement){var t=e.getCursorBounds();if(e._currentBounding=t,r&&t.dy)return void e.update(null);Object.assign(e.element.style,{opacity:n?1:0,left:"".concat(t.x,"px"),top:"".concat(t.y,"px"),height:"".concat(t.height,"px")}),r||(r=!0,e.syncScroll(t)),e._blinkId=cr(o,500)}n=!n};t?o():(this.element.style.opacity="1",this._blinkId=cr(o,500))},t.prototype.clearBlink=function(){ur(this._blinkId),this._blinkId=0},t.prototype.isActive=function(){return!!this.rangeInfo},t.prototype.getRange=function(){var t=this.rangeInfo;if(!t)return null;var e=document.createRange();return t.anchorNode?(e.selectNode(t.anchorNode),e):(e.setStart(t.startContainer,t.startOffset),e)},t.prototype.getRangeOptions=function(){var t=this.getRange();return t?{startContainer:t.startContainer,startOffset:t.startOffset}:null},t.prototype.getCurrentBounds=function(){return this._currentBounding},t.prototype.getCursorBounds=function(t){var e=t||this.getRange();if(!e)return{x:0,y:0,height:0};var n=e.getBoundingClientRect(),r=this.editor.getWrapper(),o=ct.a.getElementScale(r),i=o.x,a=o.y;i=i||1,a=a||1;var l=r.getBoundingClientRect(),c=n.x-l.x,u=n.y-l.y,s=n.height/a,f=0;return u<0?f=u:u+s>l.height&&(f=u+s-l.height),{x:c/i,y:u/a,height:s,dy:f}},t.prototype.update=function(t){var e;if(arguments.length>0&&(this.rangeInfo=lr(t)),this.element){var n=this.element.style;if(this.rangeInfo){var r=this.getRange(),o=this.getCursorBounds(r);this._currentBounding=o;var i=1===(null===(e=r.startContainer)||void 0===e?void 0:e.nodeType)?r.startContainer:r.startContainer.parentElement,a=window.getComputedStyle(i),l=i?a.color:"",c={opacity:1,left:"".concat(o.x,"px"),top:"".concat(o.y,"px"),height:"".concat(o.height,"px"),"background-color":l||"#000"};Object.assign(n,c),this.syncScroll(o),this.updateBlink(!!o.dy),Object.assign(this.input.style,{fontSize:a.fontSize,height:a.fontSize}),this.input.focus()}else this.hide(),this.input.blur()}},t.prototype.hide=function(){if(this.element){var t=this.element.style;Object.assign(t,{left:"0px",top:"0px",height:"0px"}),this.clearBlink()}},t.prototype.moveLeft=function(){if(this.isActive()){var t=new ee(this.editor,this.getRangeOptions()),e=t.startContainer,n=t.startOffset;if(n>0)n--,(t=t.new()).startContainer=e,t.startOffset=n;else{var r=zt(t.startElement,Ft,this.editor.getContainer());r&&((t=t.new()).startElement=r,t.startOffset=r.textContent.length)}this.update(t.getNativeRange())}},t.prototype.moveRight=function(){if(this.isActive()){var t=new ee(this.editor,this.getRangeOptions()),e=t.startContainer,n=t.startOffset;if(n===e.textContent.length){var r=Bt(t.startElement,Ft,this.editor.getContainer());r&&((t=t.new()).startElement=r,t.startOffset=0)}else n++,(t=t.new()).startContainer=e,t.startOffset=n;this.update(t.getNativeRange())}},t.prototype.moveTop=function(){if(this.isActive()){var t=new ee(this.editor,this.getRangeOptions());(t=Yn(this.editor.getContainer(),t.startElement,t.startOffset,-1))&&this.update(t)}},t.prototype.moveBottom=function(){if(this.isActive()){var t=new ee(this.editor,this.getRangeOptions());(t=Yn(this.editor.getContainer(),t.startElement,t.startOffset,1))&&this.update(t)}},t.prototype.render=function(){return this.element},t}(),fr=function(){function t(){this._keyMapping=Object.create(null),this._keyMatches=[]}return t.prototype.put=function(t,e){if("string"==typeof t||"number"==typeof t)this._keyMapping[t]=e;else if("function"==typeof t){if(this._keyMatches.find((function(e){return e.match===t})))return;this._keyMatches.push({match:t,transfer:e})}},t.prototype.get=function(t){var e=String(t.tagName).toLowerCase(),n=this._keyMapping[e];if(n)return n;var r=this._keyMatches.find((function(e){return e.match(t)}));return r?r.transfer:void 0},t}(),pr={};function dr(t,e){return t.getAttributeNames().reduce((function(n,r){if(pr.hasOwnProperty(r)||e&&e.hasOwnProperty(r))return n;var o=t.getAttribute(r);return n+=o?" ".concat(r,'="').concat(o,'"'):" ".concat(r)}),"").trim()}var hr=function(){function t(){this._content="",this._length=0}return t.prototype.append=function(t){t=String(t),this._content+=t,this._length+=t.length},t.prototype.size=function(){return this._length},t.prototype.toString=function(){return this._content},t}(),mr=function(){function t(){this.transfers=new fr}return t.registerIgnoreAttribute=function(t){pr[t]=!0},t.prototype.registerTransfer=function(t,e){this.transfers.put(t,e)},t.prototype.getTransfer=function(t){return this.transfers.get(t)},t.prototype.stringify=function(t){var e=this.transfers;function n(t){try{if(!t)return;if(1!==t.nodeType)return void o.append(t.textContent);var r=t,i=String(r.tagName).toLowerCase(),a=e.get(r);if(a&&a.stringify)return a.stringify.call(o,r);var l=r.firstChild,c=dr(r);for(o.append("<".concat(i).concat(c?" "+c:"",">"));l;){var u=l.nextSibling;n(l),l=u}o.append("</".concat(i,">"))}finally{}}var r=new hr,o={append:function(t){r.append(t)},size:function(){return r.size()},next:n,toString:function(){return r.toString()}};return n(t),o.toString()},t.prototype.parseNode=function(t){if(!t)return t;if(u.isElementInstanceOf(t,g))return t;if(Jt(t))return ht(t),t;var e=t,n=this.transfers.get(e);if(n&&n.parse)return n.parse(e);for(var r=e.firstElementChild;r;){var o=r.nextElementSibling,i=this.parseNode(r);i||dt(r),i!==r&&r.parentNode===e&&e.replaceChild(i,r),r=o}return e},t.prototype.parse=function(t){var e=(new DOMParser).parseFromString(t,"text/html");return this.parseNode(e)},t.getElementAttrString=dr,t}(),yr=function(){function t(){}return t.START_CURSOR="start-cursor",t.END_CURSOR="end-cursor",t}(),gr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),vr=function(t){function e(e){var n=t.call(this,{passive:!1})||this;return n._shortcutItems=[],n.editor=e,n}return gr(e,t),e.prototype.install=function(t){t.apply(this)},e.prototype.emitShortcutEvent=function(t){this._shortcutItems.some((function(e){if(e.keyInfos.some((function(e){return ct.d.matchKey(t,e)})))return t.preventDefault(),e.handler(t),!0}))},e.prototype.registerShortcutHandler=function(t,e){if(e){var n=ct.d.parseKeyString(t);this._shortcutItems.push({keyInfos:n,handler:e})}},e}(ct.c);function br(t){dt(t),xr(t)}function xr(t){Fi.getElementsByElementType(t,W).forEach((function(t){Fi.unmountCustomElement(t)}))}function Cr(t,e){Fi.getElementsByElementType(e,W).forEach((function(e){t.mountCustomElement(e)}))}var Er=function(){function t(t){this.render=t}return t.prototype._updateItem=function(t,e,n){if(e)if(t||!n){if(t.nodeType!==e.nodeType)return t.parentNode.replaceChild(e,t),xr(t),void Cr(this.render,e);if(3!==t.nodeType){var r=t,o=e;if(r.tagName!==o.tagName)return r.parentNode.replaceChild(o,r),xr(r),void Cr(this.render,o);if(function(t,e){var n=t.getAttributeNames(),r=e.getAttributeNames(),o=n.reduce((function(t,e){return t[e]=!0,t}),{});r.forEach((function(r){var i=e.getAttribute(r);if(!n.hasOwnProperty(r)||i!==t.getAttribute(r))try{t.setAttribute(r,i)}catch(t){}delete o[r]})),Object.keys(o).forEach((function(e){t.removeAttribute(e)}))}(r,o),!Jt(r))for(var i=r.firstChild,a=o.firstChild;i||a;){var l=i&&i.nextSibling,c=a&&a.nextSibling;a?i?this._updateItem(i,a,r):(r.appendChild(a),Cr(this.render,a)):br(i),i=l,a=c}}else{var u=t.textContent,s=e.textContent;u!==s&&(t.textContent=s)}}else n.appendChild(e);else br(t)},t.prototype.update=function(t){for(var e=this.render.parser.parse(t),n=this.render.getContainer(),r=n.firstChild,o=e.body.firstChild;r||o;){var i=r&&r.nextSibling,a=o&&o.nextSibling;this._updateItem(r,o,n),r=i,o=a}},t}();function Or(t){var e=ee.current(t);if(e)return _r(t.getContainer(),e.startContainer,e.endContainer)?e:null}function _r(t,e,n){for(var r=e;r&&r!==t;){if(Xt(r))return!1;if(u.isValidElement(r))break;r=r.parentNode}if(e&&(!r||r!==t&&!t.contains(r)))return!1;for(r=n;r&&r!==t;){if(Xt(r))return!1;if(u.isValidElement(r))break;r=r.parentNode}return!(n&&(!r||r!==t&&!t.contains(r)))}var wr=Object(ct.i)("unmount"),Sr=Object.create(null),Ar=function(){function t(t){this._data={},this._container=null,this._wrapper=null,this.parser=new mr,this._customUnmountElements=[],this.customElementMounts=Object.create(null),this.editMode=!1,this.loggedCommands={bold:!0,italic:!0,link:!0,style:!0,list:!0,insertBox:!0,insertImage:!0,insertTable:!0,tableSelection:!0,blockStyle:!0,sup:!0,sub:!0,stroke:!0,underline:!0,overline:!0,header:!0,paragraph:!0,insertHr:!0,insertCheckbox:!0,quote:!0,resetText:!0,keydown:!0,insertCustom:!0},this._selectionEnabled=!1,this.commandFilter=new re;var e=t||{},n=e.log,r=void 0===n||n,o=e.editMode,i=void 0===o||o;this.updater=new Er(this),this.createUI(),this.initParser(),this.baseEvents=new vr(this),this.events=new vr(this),this.editMode=!!i,this._log=r,this.actionManager=new re,this.commandManager=new lt(this),this.cursor=new sr(this),this.init()}return t.prototype.init=function(){var t,e,n,r;t=this.actionManager,En.forEach((function(e){var n=e.type;e.actions.forEach((function(e){t.add(n,e)}))})),n=(e=this).events,(r=e.baseEvents).install(Pn),r.install(Ln),n.install(On),n.install(_n),n.install(wn),n.install(Sn),n.install(An),n.install(Tn),n.install(Nn),n.install(Rn),n.install(jn),kn(e)},t.prototype.selectionEnabled=function(t){if(0===arguments.length)return this._selectionEnabled;this._selectionEnabled=!!t},t.prototype.saveRangeContext=function(){var t=Or(this);if(t)return this._range=t},t.prototype.newRange=function(t){return new ee(this,t)},t.prototype.getNormalizedRange=function(){return Or(this)||this._currentRange},t.prototype.removeRanges=function(){return ee.removeAllRanges(this)},t.prototype.saveLog=function(){this._log&&this.commandManager.execCommand("log","push")},t.prototype.blur=function(){this.cursor.update(null),this.execCommand("selectState",{type:"cancelSelect"})},t.prototype.execCommand=function(t,e,n){var r=this,o=this.commandFilter,i=Array.prototype.slice.call(arguments),a=null;return o.execute(t,{editor:this,params:e},(function(e){a=r.execute((function(){return r.loggedCommands[t]&&r.saveLog(),r.commandManager.execCommand.apply(r.commandManager,i)})),n&&n(e)})),a},t.prototype.execute=function(t){if("function"!=typeof t)return t;var e=this.getNormalizedRange();e||(e=this._range);try{return this._currentRange=e,t()}finally{this._currentRange=null}},t.prototype.checkUnmountCustomElements=function(){var e=this;this._pendingCheckUnmount||(this._pendingCheckUnmount=se((function(){e._pendingCheckUnmount=null;var n=e._customUnmountElements,r=e.getContainer();r&&(e._customUnmountElements=n.filter((function(e){return!!r.contains(e)||(t.unmountCustomElement(e),!1)})))})))},t.prototype.mountEvents=function(){var t=this.getWrapper();this.isEditMode()?this.events.mount(t):this.events.unmount()},t.prototype.render=function(t){var e=this.getWrapper();this.cursor&&e.appendChild(this.cursor.render()),this._render(t);var n,r,o=this.getContainer();u.isElementInstanceOf(o.firstElementChild,a)||(n=o,r=jt(),ft.unshiftNode(n,r)),o.setAttribute("tabindex","-1"),this.baseEvents.mount(e),this.mountEvents(),this.events.emit("didMount")},t.defineCustomMount=function(t,e){if("function"!=typeof e)throw new TypeError("mount is not a function type!");Sr[t]=e},t.prototype.defineCustomMount=function(t,e){if("function"!=typeof e)throw new TypeError("mount is not a function type!");this.customElementMounts[t]=e},t.prototype.createUI=function(){var t=this._wrapper=document.createElement("div");t.className=Ze("render");var e=this._container=document.createElement("div");e.className=Ze("content"),e.spellcheck=!1,t.appendChild(e)},t.prototype.initParser=function(){var t;t=this,mr.registerIgnoreAttribute("ky-active"),t.parser.registerTransfer("div",{stringify:function(e){if(e===t.getContainer())for(var n=e.firstElementChild;n;){var r=n.nextElementSibling;this.next(n),n=r}}}),t.parser.registerTransfer(g.tagName,{stringify:function(e){var n,r=this.range;r||(r=this.range=t.getNormalizedRange());var o=g.tagName,i=mr.getElementAttrString(e,((n={})[yr.START_CURSOR]=!0,n[yr.END_CURSOR]=!0,n));r&&(r.startElement===e&&(i&&(i+=" "),i+="".concat(yr.START_CURSOR,'="').concat(r.startOffset,'"')),r.endElement===e&&(i&&(i+=" "),i+="".concat(yr.END_CURSOR,'="').concat(r.endOffset,'"'))),this.append("<".concat(o).concat(i?" "+i:"",">")),this.append(e.innerHTML),this.append("</".concat(o,">"))}}),t.parser.registerTransfer("br",{stringify:function(t){this.append("<br/>")}}),t.parser.registerTransfer((function(t){return Jt(t)}),{stringify:function(t){var e=W.tagName,n=mr.getElementAttrString(t);this.append("<".concat(e).concat(n?" "+n:"",">")),this.append("</".concat(e,">"))},parse:function(t){return ht(t),t}}),t.parser.registerTransfer((function(t){var e=String(t.tagName).toLowerCase();return"style"===e&&!t.hasAttribute("style-setting")||u.isTagNameOutputDisabled(e)}),{stringify:function(t){}})},t.prototype.getContainer=function(){return this._container},t.prototype.getWrapper=function(){return this._wrapper},t.prototype.put=function(t,e){this._data[t]=e},t.prototype.get=function(t){return this._data[t]},t.prototype.remove=function(t){delete this._data[t]},t.prototype._render=function(t){var e=this,n=this.getContainer();!function(t){for(;t.firstChild;)dt(t.firstChild)}(n);for(var r=t.el,o=t.content,i=this.parser.parse(o||"").body.firstElementChild;i;){var a=i.nextElementSibling;n.appendChild(i),i=a}var l=this.getElementsByElementType(W);r.appendChild(this.getWrapper()),l.forEach((function(t){e.mountCustomElement(t)}))},t.prototype.mountCustomElement=function(t){try{if(u.isElementInstanceOf(t,W)){var e=t.getAttribute("type")||"",n=this.customElementMounts[e]||Sr[e],r=t[wr];if(r&&r.mount)return;if(r=t[wr]={context:this,mount:!0},n){var o=n(t,this);if("function"==typeof o){r.unmount=o;var i=this._customUnmountElements;-1===i.indexOf(t)&&i.push(t)}}}}catch(t){}},t.unmountCustomElement=function(t){try{if(u.isElementInstanceOf(t,W)){var e=t[wr];if(delete t[wr],e){var n=e.unmount,r=e.context,o=[].concat(r._customUnmountElements),i=o.indexOf(t);-1!==i&&(o.splice(i,1),r._customUnmountElements=o),"function"==typeof n&&n(t)}}}catch(t){console.error(t)}},t.prototype.getElementsByTagName=function(t,e){return this.getElementsByElementType(u.getByTagName(t).constructor,e)},t.prototype.getElementsByElementType=function(e,n){var r=this.getContainer();return t.getElementsByElementType(r,e,n)},t.getElementsByElementType=function(t,e,n){var r=[],o=function(i){if(i&&!(n&&r.length>=n)&&(u.isElementInstanceOf(i,e)&&r.push(i),!(n&&r.length>=n)&&i&&(t===i||!Jt(i))))for(var a=i.firstElementChild;a;)o(a),a=a.nextElementSibling};return o(t),r},t.prototype.setEditMode=function(t){var e=!!t;this.editMode!==e&&(this.editMode=e,this.mountEvents(),e||this.blur(),this.events.emit("editModeChange",this,[e]))},t.prototype.isEditMode=function(){return this.editMode},t.prototype.destroy=function(){this.events.emit("willDestroy"),this.events.unmount()},t.prototype.on=function(t,e){this.events.on(t,e)},t.prototype.stringify=function(){return this.parser.stringify(this.getContainer())},t.prototype.parse=function(t){return this.parser.parse(t)},t.prototype.scrollTop=function(t){var e=this.getContainer();if(0===arguments.length)return e.scrollTop;e.scrollTop=t},t.prototype.scrollLeft=function(t){var e=this.getContainer();if(0===arguments.length)return e.scrollLeft;e.scrollLeft=t},t.isRangeElementValid=_r,t}(),Tr=Ar;Ar.defineCustomMount("ky-image",(function(t){var e=t.getAttribute("src")||"",n=new Image;n.src=e,ht(t),t.appendChild(n)}));var Nr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Rr=u.getElementType(g),jr=function(t){function e(e){var n=t.call(this,e)||this;return n.currentRange={},n.elementType=Rr,n}return Nr(e,t),e.createElement=function(){return Rr.create()},e.prototype.syncElementState=function(t){return t},e.isElementType=function(t,e){return void 0===e&&(e=!1),u.isElementInstanceOf(t,g,e)},e.prototype.visitRangeTextElement=function(t,e){var n=this.getContainer(),r=t.startElement,o=t.endElement;if(r!==o){var i=!1,a=function(t){if(!i&&rt.isElement(t))if(Ht(t)){var r=pt(t),c=t.parentElement;if(e(t,{stop:l}),t===o&&(i=!0),!i){for(;!i&&r;)a(r),r=pt(r);if(!i&&c!==n){for(;c&&c!==n;){if(pt(c))break;c=c.parentElement}var u=pt(c);u&&a(u)}}}else for(var s=Array.prototype.slice.call(t.children),f=s.length,p=0;!i&&p<f;p++)a(s[p])};a(r)}else e(r);function l(){i=!0}},e.prototype.isActive=function(t){return e.isElementType(t)},e.prototype.isRangeActive=function(t){var e=this,n=t.startElement;if(n===t.endElement)return this.isActive(n);var r=!0,o=Date.now();return this.visitRangeTextElement(t,(function(t,n){(Date.now()-o>=1500||!e.isActive(t))&&(r=!1,n.cancel())})),r},e.prototype.isEnabled=function(){return!0},e.prototype.isNeedSyncState=function(t){var e=this.isActive(t);return this.isEnabled()!==e},e.prototype.execCommandAtElement=function(t,e,n){void 0===e&&(e=0);var r=t.textContent,o=this.currentRange;if(this.isNeedSyncState(t))if(r&&1!==arguments.length){var i=this;arguments.length<3&&(n=r.length);var a=r.slice(0,e),l=r.slice(e,n),c=r.slice(n),u=document.createDocumentFragment();[a,l,c].forEach((function(e,n){if(e){var r=t.cloneNode(),a=1===n?i.syncElementState(r):r;e=a.textContent||e,a.textContent=e,1===n&&(o.startElement===t&&(o.startElement=a,o.startOffset=0),o.endElement===t&&(o.endElement=a,o.endOffset=e.length)),u.appendChild(a)}})),t.parentElement.replaceChild(u,t)}else this.syncElementState(t)},e.prototype.execCommandAtRange=function(){var t=this.currentRange=this.getRange();this._execCommandAtRange(),t.select()},e.prototype._execCommandAtRange=function(){var t=this,e=this.currentRange,n=e.startElement,r=e.endElement,o=e.startOffset,i=e.endOffset;if(n!==r)this.visitRangeTextElement(e,(function(a){var l=a.parentElement,c=l.lastElementChild===a;n===a?t.execCommandAtElement(a,o):r===a?t.execCommandAtElement(a,0,i):t.execCommandAtElement(a),c&&Tt(l,{range:e,match:Ht})}));else{if(!this.isNeedSyncState(n))return;Ht(n)&&t.execCommandAtElement(n,o,i)}},e.prototype.executeWhileCollapse=function(){var t=this.commandManager,e=this.getRange(),n=t.pendingCommands,r=e.startElement,o=this.isEnabled();if(n.isEnabled()&&!n.range.equals(e)&&n.clear(),n.isEnabled()){var i=n.element;o!==this.isActive(i)&&(i=this.syncElementState(i)),St(r,i)&&n.clear()}else{if(o!==this.isActive(r)){i=r.cloneNode();i=this.syncElementState(i),n.element=i}yt(r)&&(e.startOffset=0,e.isTextEmpty=!0),n.range=e}e.select()},e}(rt),kr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Mr(t,e,n){void 0===e&&(e={});var r=_t(t,n);return Object.keys(n).some((function(t){var n=r[t];if(e.hasOwnProperty(t)){var o=e[t];if(-1===o.indexOf(n))return o.push(n),!0}else e[t]=[n]})),e}var Pr=function(t){function e(e){var n=t.call(this,e)||this;return n.attrName="style",n.commandType=tt,n}return kr(e,t),e.prototype.initModel=function(){return{value:null}},e.prototype.getRangeStyle=function(t,e){var n={},r=Date.now();return this.visitRangeTextElement(t,(function(t,o){if(o&&(Date.now()-r>=1500||Object.keys(e).every((function(t){var e=n[t];return e&&e.length>1}))))return void o.stop();Mr(t,n,e)})),n},e.prototype.getStyle=function(t){var e=t.type,n=t.styleNames,r=this.commandManager.editor,o=[].concat(n).reduce((function(t,e){return t[e]=!0,t}),{}),i=this.getRange(),a={};return"block"===e?(Mr(Vt(i.startElement,r.getContainer()),a,o),a):i.collapsed?(Mr(i.startElement,a,o),a):this.getRangeStyle(i,o)},e.prototype.getState=function(t){var e=this.createState();return e.data=this.getStyle.apply(this,arguments),e},e.prototype.isActive=function(t){if(1!==t.nodeType)return!1;var e=this.getModel(),n=_t(t.getAttribute("style")||""),r=e.value||{};return Object.keys(r).every((function(t){if(!n)return!1;var e=r[t];return n[t]===e}))},e.prototype.isEnabled=function(){return!0},e.prototype.syncElementState=function(t){var e=this.getModel(),n=_t(t.getAttribute("style")||""),r=e.value;r&&Object.assign(n,r);var o=n.toString();return o?t.setAttribute("style",o):t.removeAttribute("style"),t},e.prototype.execute=function(t){var e=this.getRange();this.getModel().value=Et(t),e.collapsed?this.executeWhileCollapse():this.execCommandAtRange()},e.fillStyleValues=Mr,e}(jr),Ir=function(){function t(t){this.values={},t&&(this.values=String(t).split(/\s+/).reduce((function(t,e){return t[e]=!0,t}),{}))}return t.prototype.addValue=function(t){if(t){var e=String(t).split(/\s+/),n=this.values;e.forEach((function(t){t&&!n.hasOwnProperty(t)&&(n[t]=!0)}))}},t.prototype.removeValue=function(t){if(t){var e=String(t).split(/\s+/),n=this.values;e.forEach((function(t){delete n[t]}))}},t.prototype.contains=function(e){if(!e)return!1;e instanceof t||(e=new t(e));var n=this.values;return Object.keys(e.values).every((function(t){return n.hasOwnProperty(t)}))},t.prototype.toString=function(){return Object.keys(this.values).join(" ")},t}(),Br=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),zr={"text-decoration":1},Lr=function(t){function e(e){return t.call(this,e)||this}return Br(e,t),e.prototype.initModel=function(){return{enabled:!1,styles:[]}},e.prototype.getStyleItems=function(){return this.getModel().styles||[]},e.prototype.isCompositionStyleValue=function(t,e){return zr.hasOwnProperty(t)},e.prototype.isStyleValueEqual=function(t,e,n){return e&&n&&this.isCompositionStyleValue(t,n)?new Ir(e).contains(n):e===n},e.prototype.syncStyleValue=function(t){var e=this,n=this.isEnabled();this.getStyleItems().forEach((function(r){var o=t[r.name];if(n)e.isCompositionStyleValue(r.name,r.value)?((i=new Ir(o)).addValue(r.value),t[r.name]=i.toString()):t[r.name]=r.value;else if(o){var i;(i=new Ir(o)).removeValue(r.value),t[r.name]=i.toString()}}))},e.prototype.isActive=function(t){var e=this;if(1!==t.nodeType)return!1;var n=_t(t.getAttribute(this.attrName)||"");return this.getStyleItems().every((function(t){return e.isStyleValueEqual(t.name,n[t.name],t.value)}))},e.prototype.isEnabled=function(){return this.getModel().enabled},e.prototype.syncElementState=function(t){if(0===this.getStyleItems())return null;var e=this.attrName,n=_t(t.getAttribute(e)||"");this.syncStyleValue(n);var r=n.toString();return r?t.setAttribute(e,r):t.removeAttribute(e),t},e.prototype.getState=function(t){var e=this.createState(),n=this.getRange();return n.collapsed?(e.data=this.isActive(n.startElement),e):(e.data=this.isRangeActive(n),e)},e.prototype.execute=function(t){var e,n=this.getRange(),r=this.getModel();r.enabled=0===arguments.length?!(null===(e=this.getState())||void 0===e?void 0:e.data):!!t,n.collapsed?this.executeWhileCollapse():this.execCommandAtRange()},e}(Pr),Vr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Dr=function(t){function e(e){return t.call(this,e)||this}return Vr(e,t),e.prototype.initModel=function(){return{enabled:!1,styles:[{name:"font-weight",value:"bold"}]}},e}(Lr),Ur=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wr=function(t){function e(e){return t.call(this,e)||this}return Ur(e,t),e.prototype.initModel=function(){return{enabled:!1,styles:[{name:"font-style",value:"italic"}]}},e}(Lr),Hr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fr=function(t){function e(e){return t.call(this,e)||this}return Hr(e,t),e.prototype.execute=function(t){var e=this.commandManager,n=t.element,r=t.style,o=t.attrs,i=t.resize,a=void 0!==i&&i,l=this.getRange().startOffset,c=n;if(c||(c=this.createElement()),a){var u={rotate:t.rotate};a&&"boolean"!=typeof a&&(u.resizeModes=a);var s=this.createBehaviorElement(u);s.appendChild(c),c=s}return bt(c,{style:r,attrs:o}),e.execCommand("input",{element:c,offset:l,endOffset:l}),c},e}(rt),qr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zr=u.getElementType(C),Kr=function(t){function e(e){var n=t.call(this,e)||this;return n.elementType=Zr,n}return qr(e,t),e.prototype.isEnabled=function(){return!0},e.prototype.createLinkElement=function(){var t=this.getModel(),e=this.createElement(),n=t.value;return n&&Object.keys(n).forEach((function(t){var r=n[t];r&&"text"!==t&&e.setAttribute(t,r)})),e},e.prototype.execute=function(e){var n=this.getRange();this.getModel().value=e,n.collapsed||n.extractContents();var r=this.createLinkElement(),o=null==e?void 0:e.text;r.setAttribute("target","_blank"),r.setAttribute("href",e.href);var i=st();i.textContent=o,r.appendChild(i),t.prototype.execute.call(this,{element:r})},e}(Fr),Jr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Xr(t,e){return zt(t,qt,e)}var Gr=function(t){function e(e){return t.call(this,e)||this}return Jr(e,t),e.prototype.backspaceUntilNextTextElement=function(t){var e=this.commandManager.editor,n=t.startElement;if(n&&!qt(n)){var r=Lt(n);r&&(n=r)}var o,i=Xr(n,e.getContainer()),a=0;i&&(Ft(i)?(o=i,a=i.textContent.length):mt(o=st(),i),Wt({start:n,containStart:!0,end:o}),(t=t.new()).startElement=o,t.startOffset=a,Tt(o.parentElement,{match:Ft,range:t}),t.select())},e.prototype.backspaceTextNormal=function(t,e){var n,r=this.commandManager.editor,o=t.startElement,i=t.startOffset,l=(e||{}).count,c=void 0===l?1:l,s=In((function(){return Xr(o,r.getContainer())})),f=In((function(){return Vt(s(),r.getContainer())})),p=In((function(){return Vt(o,r.getContainer())})),d=o.textContent,h=d.slice(0,i),m=d.slice(i),y=yt(h);if(y&&h&&(o.textContent=m),!y){var g=(h=h.slice(0,Math.max(0,h.length-c)))+m,v=o,b=h.length;o.textContent=g;var x=yt(h),C=x;if(x){var E=s();if(E)f()===p()&&(Ft(E)?(v=E,b=E.textContent.length,Wt({start:o,containStart:yt(g),end:E}),C=!0):E&&Wt({start:o,end:E}));else if(yt(g)){if(Ft(v.nextElementSibling)){var O=v.nextElementSibling;dt(v),v=O,b=0}C=!0}}return(t=t.new()).startElement=v,t.startOffset=b,C&&vt(t),void t.select()}var _=s(),w=this.findNearestMatch(_,(function(t){return u.isElementInstanceOf(t,a)}));w&&(w!==this.findNearestMatch(o,(function(t){return u.isElementInstanceOf(t,a)}))&&(_=null));if(_){var S,T,N=f(),R=p();if(N===R||R.contains(N)){var j=o,k=0,M=Ft(_);!M&&Ft(_.previousElementSibling)&&(_=_.previousElementSibling,M=!0);var P=M;if(Wt({start:o,containStart:M&&yt(o),end:_,containEnd:!M,container:r.getContainer()}),M){j=_;var I=_.textContent||"";k=I.length,P=yt(I)}return(t=t.new()).startElement=j,t.startOffset=k,P&&vt(t),void t.select()}for(var B=document.createDocumentFragment(),z=R.firstElementChild,L=0;z;){var V=z.nextElementSibling;u.isHelpElement(z)||0==L++&&Ft(z)&&yt(z)?(dt(z),z=V):(B.appendChild(z),z=V)}var D=_,U=0,W=!1;if(Ft(D)){var H=_.textContent||"";U=H.length,W=yt(H)}else Ft(B.firstElementChild)?D=D.nextElementSibling:mt(D=st(),_);var F=R.parentElement;Wt({start:R,containStart:!0,end:D,container:r.getContainer()}),F===_.parentElement?mt(B,D):_.parentNode.appendChild(B),(t=t.new()).startElement=D,t.startOffset=U,W&&vt(t),t.select()}else{var q=ct.a.findUpUtil(o,(function(t){return u.isElementInstanceOf(t,a)}),(function(t){return t===r.getContainer()}));if(yt(o)&&(S=o).getAttributeNames().forEach((function(t){T&&T.hasOwnProperty(t)||S.removeAttribute(t)})),q){var Z=p();if(Z&&!u.isElementInstanceOf(Z,A)){var K=document.createDocumentFragment();gt(Z,K),null===(n=Z.parentElement)||void 0===n||n.replaceChild(K,Z)}}t.select()}},e.prototype.backspaceWhileCollapsed=function(t,e){Ft(t.startElement)?this.backspaceTextNormal(t,e):this.backspaceUntilNextTextElement(t)},e.prototype.backspaceAtRange=function(t){var e=this.commandManager.editor,n=t.startElement,r=t.startOffset,o=t.endElement,i=t.endOffset;if(n===o){var a=n.textContent;n.textContent=a.slice(0,r)+a.slice(i)}else{var l={start:o,containStart:!Ft(o),end:n,containEnd:!Ft(n)};l.containEnd||(n.textContent=n.textContent.slice(0,r)),l.containStart||(o.textContent=o.textContent.slice(i),l.containStart=yt(o)),Wt(l)}if(Ft(n))(t=t.new()).startElement=n,t.startOffset=r,vt(t),t.select();else{var c=e.getContainer();if(c.firstElementChild)Ft(o)&&((t=t.new()).startElement=o,t.startOffset=0,vt(t),t.select());else{var u=ut(),s=st();u.appendChild(s),c.appendChild(u),(t=t.new()).startElement=s,t.startOffset=0,t.select()}}},e.prototype.execute=function(t){var e=this.getRange();if(e.collapsed)this.backspaceWhileCollapsed(e,t);else{if(!Zt(e,this.getContainer()))return;this.backspaceAtRange(e)}},e}(rt),Yr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Qr=function(t){function e(e){return t.call(this,e)||this}return Yr(e,t),e.prototype.execute=function(t){var e=this.commandManager,n=e.editor,r=this.getRange();if(r.collapsed){var o=r.startElement,i=r.startOffset,a=(t||{}).count,l=void 0===a?1:a,c=In((function(){return Bt(o,qt,(function(t){return t===n.getContainer()||u.isElementInstanceOf(t,O)}))}));if(Ft(o)){var s=(d=o.textContent||"").slice(0,i),f=d.slice(i);if(f.length>0){if(d=s+(f=f.slice(Math.max(0,l))),o.textContent=d,!d){var p=c();Ft(p)?((r=r.new()).startElement=p,r.startOffset=0,Wt({start:p,end:o,containEnd:!0}),vt(r)):vt(r)}return void r.select()}}var d,h=c();if(h)if(Ft(h))d=(d=h.textContent||"").slice(1),h.textContent=d,(r=r.new()).startElement=h,r.startOffset=0,vt(r),r.select();else Wt({start:h,containStart:!0,end:o}),vt(r),r.select()}else e.execCommand("backspace")},e}(rt),$r=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),to=function(t){function e(e){return t.call(this,e)||this}return $r(e,t),e.prototype.execute=function(t){var e=t||{},n=e.offset,r=e.endOffset,o=e.element,i=this.getRange();void 0===r&&(r=n);var a=i.startElement;if(jr.isElementType(a)){var l=a.textContent||"",c=l.slice(0,n),u=l.slice(r),s=document.createDocumentFragment(),f=a.cloneNode();f.textContent=c,s.appendChild(f),s.appendChild(o);var p=a.cloneNode(),d=document.createTextNode(u);p.appendChild(d),s.appendChild(p),a.parentElement.replaceChild(s,a),i=i.new();var h=!1;if(jr.isElementType(o))i.startContainer=o.lastChild||o,o.lastChild&&(i.startOffset=o.lastChild.textContent.length),h=!0;else{var m=Pt(o);!m&&Ft(o.nextElementSibling)?(m=o.nextElementSibling,i.startElement=m,i.startOffset=0,h=!0):Ft(m)&&(i.startElement=m,i.startOffset=m.textContent.length,h=!0)}At(o.parentNode,{match:function(t){return jr.isElementType(t)},range:i}),h&&i.select()}},e}(rt),eo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var no=function(t){function e(e){return t.call(this,e)||this}return eo(e,t),e.prototype.execute=function(t){var e=this.getRange(),n=e.collapsed,r=e.startElement,o=e.startContainer,i=e.startOffset,a=this.findNearest(o);if(a){var l,c=function(t){return u.isElementInstanceOf(t,M)}(a)?ut():a.cloneNode();if(n){var s=a.lastChild,f=0,p=Ft(s);if(rt.isTextNode(s)||p){var d=s.textContent;f=d?d.length:0}(e=e.new()).startContainer=o,e.startOffset=i,p?e.endElement=s:e.endContainer=s,e.endOffset=f;var h=e.extractContents();Ht(h.lastElementChild)||h.appendChild(Ft(r)?r.cloneNode():(new g).create()),vt({startElement:r,startOffset:0});for(var m=h.firstChild;m;){var y=m.nextSibling;if(u.isValidElement(m))c.appendChild(m);else if(3===m.nodeType&&!yt(m)){var v=Ft(r)?r.cloneNode():jr.createElement();v.appendChild(m),c.appendChild(v)}m=y}Tt(c,{match:Ft,range:e}),e=e.new();var b=function(t){for(;t;){if(Ft(t))return t;t=t.firstElementChild}return null}(c);b||(b=jr.createElement(),c.firstChild?c.insertBefore(b,c.firstChild):c.appendChild(b)),l=b}else{var x=this.findNearest(e.endContainer);if(e.extractContents(),x)for(m=x.firstElementChild;m;){m=y=m.nextElementSibling}var C=jr.createElement();c.appendChild(C),l=C,e=e.new()}!function(t){if(!t.firstElementChild){var e=jr.createElement();t.appendChild(e)}}(a),mt(c,a),e.startElement=l,e.startOffset=0,e.select()}},e}(ue),ro=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();var oo=function(t){function e(e){return t.call(this,e)||this}return ro(e,t),e.prototype.execute=function(t){if(t){var e=this.commandManager,n=e.pendingCommands,r=this.getRange(),o=r.startContainer,i=r.startOffset,a=r.startElement,l=0,c=null;if(u.isElementInstanceOf(a,b)||u.isElementInstanceOf(a.parentNode,b)){var s=i,f=(v=(v=a.textContent||"").slice(0,s)+v.slice(s)).slice(0,s);(function(t){var e=t.parentNode;return!!e&&e.firstElementChild===t}(a)&&!f||function(t){var e=t.parentNode;return!!e&&e.lastElementChild===t}(a)&&f===v)&&(l=1,v&&!f&&(l=2),c=u.isElementInstanceOf(a,b)?a:a.parentElement)}if(n.isEnabled()){var p=n.range,d=p.startContainer,h=p.startOffset,m=p.startElement;if((d===o||m===a)&&(i===h||yt(a))){var y=n.element.cloneNode();return void(l?(y.textContent=t,1===l?mt(y,c):c.parentElement.insertBefore(y,c),(r=r.new()).startElement=y,r.startOffset=y.textContent.length,r.select()):(y.textContent=t,e.execCommand("input",{offset:i,endOffset:i,element:y})))}}if(l)if(!(f=(v=a.textContent).slice(0,i))||f===v){(y=jr.createElement()).textContent=t;var g=u.isElementInstanceOf(a,b)?a:a.parentNode;return 1===l?mt(y,g):g.parentElement.insertBefore(y,g),(r=r.new()).startElement=y,r.startOffset=t.length,void r.select()}if(jr.isElementType(a)){var v,x=(v=a.textContent).slice(0,i);return yt(x)&&(i=0),v=x+t+v.slice(i),a.textContent=v,(r=r.new()).startElement=a,r.startOffset=i+t.length,At(a.parentNode,{match:function(t){return jr.isElementType(t)},range:r}),void r.select()}!function(t,e){var n=t.startContainer,r=jr.createElement();r.textContent=e,n.parentNode.replaceChild(r,n),(t=t.new()).startElement=r,t.startOffset=e.length,Tt(r.parentNode,{match:function(t){return jr.isElementType(t)},range:t}),t.select()}(r,t)}},e}(rt),io=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ao=new f,lo=function(t){function e(e){var n=t.call(this,e)||this;return n.elementType=ao,n}return io(e,t),e.prototype.execute=function(e){return t.prototype.execute.call(this,e)},e}(Fr),co=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),uo=u.getElementType(W),so=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.elementType=uo,e}return co(e,t),e.prototype.execute=function(e){var n=e||{},r=n.type,o=n.width,i=n.height,a=n.style,l=n.attrs,c=n.rotate,u=void 0===c||c,s=n.resize,f=void 0===s||s;if("string"!=typeof r&&"number"!=typeof r)throw new Error("params.type is invalid !");var p=this.elementType.create({innerHTML:null==e?void 0:e.innerHTML,type:r});bt(p,{style:a,attrs:l});var d={};f&&(o&&(d.width="number"==typeof o?"".concat(o,"px"):o),i&&(d.height="number"==typeof i?"".concat(i,"px"):i)),t.prototype.execute.call(this,{element:p,rotate:u,resize:f,style:d}),this.commandManager.editor.mountCustomElement(p)},e}(lo),fo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),po=function(t){function e(e){return t.call(this,e)||this}return fo(e,t),e.prototype.execute=function(e){var n=e||{},r=n.title,o=n.src,i=n.width,a=void 0===i?100:i,l=n.height,c=void 0===l?100:l;t.prototype.execute.call(this,{resize:!0,type:"ky-image",width:a,height:c,attrs:{class:Ze("image"),src:o,title:r}})},e}(so),ho=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mo=function(t){function e(e){return t.call(this,e)||this}return ho(e,t),e.prototype.execute=function(){var t=this.getRange();if(!t.collapsed){var e=t.endContainer,n=t.endOffset;return(t=t.new()).startContainer=e,t.startOffset=n,void t.select()}var r=t.startElement,o=t.startOffset;if(Ft(r)){var i=r.textContent||"",a=i.slice(0,o),l=i.slice(o),c="".concat(a,"&nbsp;&nbsp;&nbsp;&nbsp;").concat(l);r.innerHTML=c,(t=t.new()).startElement=r,t.startOffset=a.length+4,t.select()}},e}(rt),yo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function go(t,e){for(;t&&t!==e&&(n=t,!u.isElementInstanceOf(n,O));)t=t.parentNode;var n;return t}function vo(t){return u.isElementInstanceOf(t,g)}var bo=function(t){function e(e){var n=t.call(this,e)||this;return n.commandType=tt,n}return yo(e,t),e.prototype.initModel=function(){return{value:null}},e.prototype.syncElementState=function(t){var e=this.getModel(),n=_t(t.getAttribute("style")),r=e.value;r&&Object.assign(n,r);var o=n.toString();return o?t.setAttribute("style",o):t.removeAttribute("style"),t},e.prototype.isActive=function(t){if(1!==t.nodeType)return!1;var e=this.getModel(),n=_t(t.getAttribute("style")||""),r=e.value||{};return Object.keys(r).every((function(t){return!!n&&n[t]===r[t]}))},e.prototype.executeAtRange=function(){!function(t){var e=t.container,n=t.command,r=t.range,o=r.startElement,i=r.endElement,a=o,l=[],c=function(t){-1===l.indexOf(t)&&(l.push(t),n.syncElementState(t))},u=function(t){var n=vo(t);if(t===i&&n)return c(go(t,e)),!1;if(!n){for(var r=t.firstElementChild;r;)if(-1===l.indexOf(r)){var o=r.nextElementSibling,a=u(r);if(!1===a)return a;r=o}return t!==i&&void 0}c(go(t,e))};t:for(;a&&a!==e;){for(var s=a.nextElementSibling,f=a.parentNode;s;){var p=s.nextElementSibling;if(!1===u(s))break t;s=p}a=f}vo(o)?c(go(o,e)):u(o)}({range:this.getRange(),container:this.getContainer(),command:this})},e.prototype.execute=function(t){var e=this.getRange();this.getModel().value=Et(t);var n=this.commandManager.editor;if(e.collapsed){var r=go(e.startContainer,n.getContainer());r&&this.syncElementState(r)}else this.executeAtRange();e.select()},e}(rt),xo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();function Co(t,e,n){Object.keys(n).forEach((function(n){var r=t.getAttribute(n);if(e.hasOwnProperty(n))e[n]=[r];else{var o=e[n];-1===o.indexOf(r)&&(o.push(r),e[n]=o)}}))}var Eo=function(t){function e(e){var n=t.call(this,e)||this;return n.commandType=$,n}return xo(e,t),e.prototype.getRangeAttrs=function(t,e){e=e||{};var n={};return this.visitRangeTextElement(t,(function(t){Co(t,n,e)})),n},e.prototype.getAttributes=function(t){var e=t.attrNames,n=[].concat(e).reduce((function(t,e){return t[e]=!0,t}),{}),r=this.getRange(),o={};return r.collapsed?(Co(r.startElement,o,n),o):this.getRangeAttrs(r,n)},e.prototype.syncElementState=function(t){var e=this.getModel();return this.isEnabled()?t.setAttribute(e.name,e.value):t.removeAttribute(e.name),t},e}(jr),Oo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),_o=function(t){function e(e){return t.call(this,e)||this}return Oo(e,t),e.prototype.isActive=function(e){if(!e||1!==e.nodeType)return!1;var n=this.getModel();return t.prototype.isActive.call(this,e)&&e.getAttribute(n.name)===Y},e.prototype.isEnabled=function(){return this.getModel().value===Y},e.prototype.getState=function(t){var e=this.createState(),n=this.getRange();return n.collapsed?(e.data=this.isActive(n.startElement),e):(e.data=this.isRangeActive(n),e)},e.prototype.execute=function(t){var e=this.getRange();this.getModel().value=t?Y:Q,e.collapsed?this.executeWhileCollapse():this.execCommandAtRange()},e}(Eo),wo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),So=function(t){function e(e){return t.call(this,e)||this}return wo(e,t),e.prototype.initModel=function(){return{name:"su",value:"0"}},e.prototype.getAttributeValue=function(){return"1"},e.prototype.isActive=function(t){if(!t||1!==t.nodeType)return!1;var e=this.getModel();return u.isElementInstanceOf(t,g)&&t.getAttribute(e.name)===this.getAttributeValue()},e.prototype.isEnabled=function(){return this.getModel().value===this.getAttributeValue()},e.prototype.execute=function(t){var e=this.getRange();this.getModel().value=t?this.getAttributeValue():"0",e.collapsed?this.executeWhileCollapse():this.execCommandAtRange()},e}(_o),Ao=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),To=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Ao(e,t),e.prototype.getAttributeValue=function(){return"2"},e}(So),No=function(t){this.time=(new Date).getTime(),this.data=String(t)},Ro=function(){function t(){this.maxSize=50}return t.prototype.pushLog=function(t){var e=this.cursor;if(!e||e.data!==t){var n=new No(t);e&&(e.right&&(e.right.left=null),e.right=n,n.left=e),this.cursor=n,this._control()}},t.prototype._control=function(){for(var t=this.cursor,e=0;t&&e<this.maxSize-1;)t=t.left,e++;t&&(t.left=null)},t.prototype.isEmpty=function(){return!!this.cursor},t.prototype.isCancelEnabled=function(){var t=this.cursor;return!!t&&(!!t.left||!t.left&&!t.right)},t.prototype.isRedoEnabled=function(){return this.isHasNextItem()},t.prototype.isHasNextItem=function(){var t=this.cursor;return!(!t||!t.right)},t.prototype.isHasPreviousItem=function(){var t=this.cursor;return!(!t||!t.left)},t.prototype.nextItem=function(){if(this.isHasNextItem())return this.cursor=this.cursor.right},t.prototype.previousItem=function(){if(this.isHasPreviousItem())return this.cursor=this.cursor.left},t}(),jo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ko=function(t){function e(e){var n=t.call(this,e)||this;return n.logManager=new Ro,n.commandType=nt,n.pendingAutoFocus=null,n.isTopStack=!0,n}return jo(e,t),e.prototype.autoFocus=function(){var t=this;this.pendingAutoFocus||(this.pendingAutoFocus=se((function(){t.pendingAutoFocus=null;var e,n=t.getEditor(),r=n.getContainer(),o=yr.START_CURSOR,i=yr.END_CURSOR,a=r.querySelector("[".concat(o,"]")),l=r.querySelector("[".concat(i,"]"));if((a||l)&&(e=n.newRange(),a&&(e.startElement=a,e.startOffset=0|a.getAttribute(o),a.removeAttribute(o)),l&&(e.endElement=l,e.endOffset=0|l.getAttribute(i),l.removeAttribute(i)),e.select(),!e.collapsed)){var c=n.getContainer();null==c||c.focus()}n.cursor.update()})))},e.prototype.cancel=function(){this.isTopStack&&(this.isTopStack=!1,this.push(!0)),console.time("popLog");var t=this.getEditor(),e=this.logManager.previousItem();e&&t.updater.update(e.data),console.timeEnd("popLog"),this.autoFocus()},e.prototype.redo=function(){console.time("popLog");var t=this.getEditor(),e=this.logManager.nextItem();e&&t.updater.update(e.data),console.timeEnd("popLog"),this.autoFocus()},e.prototype.push=function(t){console.time("pushLog");var e=this.getEditor().stringify();this.logManager.pushLog(e),console.timeEnd("pushLog"),t||(this.isTopStack=!0)},e.prototype.getState=function(t){var e=this.createState(),n=this.logManager,r=n.isRedoEnabled(),o=n.isCancelEnabled();return e.data={cancel:o,redo:r},e},e.prototype.execute=function(t){"cancel"===t?this.cancel():"redo"===t?this.redo():"push"===t&&this.push()},e}(rt),Mo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Po=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.styleValue="",e}return Mo(e,t),e.prototype.initModel=function(){return{enabled:!1,styles:[{name:"text-decoration",value:this.styleValue}]}},e.prototype.isCompositionStyleValue=function(e,n){return!!n&&t.prototype.isCompositionStyleValue.call(this,e,n)},e.prototype.execute=function(e){return t.prototype.execute.call(this,e)},e}(Lr),Io=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.styleValue="line-through",e}return Mo(e,t),e}(Po),Bo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.styleValue="underline",e}return Mo(e,t),e}(Po),zo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.styleValue="overline",e}return Mo(e,t),e}(Po),Lo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mo(e,t),e.Stroke=Io,e.Underline=Bo,e.Overline=zo,e}(Po),Vo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Do=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Vo(e,t),e.prototype.execute=function(t){var e=this.getRange(),n=e.startContainer,r=e.startOffset,o=Dt(n,this.commandManager.editor.getContainer());if(o){(e=e.new()).startContainer=n,e.startOffset=r,e.endContainer=o,e.endOffset=o.childElementCount;for(var i=e.extractContents().firstChild,a=document.createDocumentFragment(),l=ut(),c=l;i;){var s=i.nextSibling;if(u.isElementInstanceOf(i,A)){i.childElementCount>0&&(c=i,a.appendChild(i)),i=s}else{if(3!==i.nodeType||yt(i))u.isValidElement(i)&&c.appendChild(i);else(f=st()).appendChild(i),c.appendChild(f);i=s}}if(c===l){if(0===c.childElementCount){var f=st();c.appendChild(f)}a.appendChild(c)}var p=Pt(a);mt(a,o),p&&((e=e.new()).startElement=p,e.startOffset=0,vt(e),e.select())}},e}(rt),Uo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Wo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Uo(e,t),e.prototype.isElementType=function(t){return u.isElementInstanceOf(t,M)},e.prototype.getState=function(t){var e=this.createState(),n=this.getRange(),r=this.commandManager.editor,o=Dt(n.startElement,r.getContainer());if(!o)return e;if(this.isElementType(o)){var i=o.getAttribute("level")||1;e.data={level:i}}return e},e.prototype.execute=function(t){var e=(t||{}).level;e=Number(e)||0;var n=this.commandManager.editor,r=this.getRange(),o=Dt(r.startElement,n.getContainer());if(o){if(u.isElementInstanceOf(o,M)){var i=o.getAttribute("level");(i=Number(i)||0)!==e&&o.setAttribute("level",e)}else{var a=u.createElement(M);a.setAttribute("level",e),this.extractContentNodes(o,a),o.parentElement.replaceChild(a,o)}r.select()}},e}(ue),Ho=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Fo=u.getElementType(I),qo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.elementType=Fo,e}return Ho(e,t),e.prototype.execute=function(){var e=this.elementType.create();e.style["background-color"]="#ccc",t.prototype.execute.call(this,{element:e,resize:!0,style:{width:"100%",height:"5px"}})},e}(Fr),Zo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ko=function(){return(Ko=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Jo=u.getElementType(z),Xo=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.elementType=Jo,e}return Zo(e,t),e.prototype.execute=function(e){var n=this.elementType.create(),r=this.createBehaviorElement();r.appendChild(n);r.style.width="".concat(16,"px"),r.style.height="".concat(16,"px"),t.prototype.execute.call(this,Ko(Ko({},e),{element:r,resize:!1}))},e}(Fr),Go=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yo=u.getElementType(A),Qo=function(t){function e(e){var n=t.call(this,e)||this;return n.elementType=Yo,n}return Go(e,t),e.createElement=function(){return Yo.create()},e.isElementType=function(t){return u.isElementInstanceOf(t,A)},e.prototype.isElementMatched=function(t,n){return n?u.isElementInstanceOf(t,A,n):e.isElementType(t)},e.prototype.isElementType=function(t,e){return u.isElementInstanceOf(t,A,e)},e.prototype.getState=function(t){var e=this.createState(),n=this.getRange(),r=this.commandManager.editor,o=Dt(n.startElement,r.getContainer());return e.data=this.isElementType(o),e},e.prototype.execute=function(){var t=this.getRange(),e=this.commandManager.editor,n=Dt(t.startElement,e.getContainer());if(n)if(this.isElementType(n,!0))t.select();else{var r=this.elementType.create();this.extractContentNodes(n,r),n.parentNode.replaceChild(r,n),t.select()}},e}(ue),$o=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ti=u.getElementType(D),ei=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.elementType=ti,e}return $o(e,t),e.prototype.isElementType=function(t){return u.isElementInstanceOf(t,D)},e.prototype.getState=function(t){var e=this.createState(),n=this.getRange(),r=this.findNearest(n.startElement);return r?(e.data=u.isElementInstanceOf(r.parentElement,D),e):e},e.prototype.execute=function(t){var e=this.getRange(),n=this.findNearest(e.startElement);if(n){if(t){if(this.isElementType(n.parentElement))return void e.select();var r=this.elementType.create(),o=n.cloneNode();return this.extractContentNodes(n,o),r.appendChild(o),n.parentNode.replaceChild(r,n),void e.select()}if(this.isElementType(n.parentNode)){var i=n.parentNode,a=this.extractContentNodes(i);i.parentNode.replaceChild(a,i),e.select()}else e.select()}},e}(Qo),ni=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ni(e,t),e.prototype.isActive=function(t){return!1},e.prototype.syncElementState=function(t){return t.getAttributeNames().forEach((function(e){t.removeAttribute(e)})),t},e.prototype.execute=function(){this.getRange().collapsed?this.executeWhileCollapse():this.execCommandAtRange()},e}(jr),oi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ii=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return oi(e,t),e.prototype.cancel=function(){this.formatAttrs=null,this.getRange().select()},e.prototype.extractFormat=function(){var t=this.getRange(),e={};this.visitRangeTextElement(t,(function(t){t.getAttributeNames().forEach((function(n){e[n]=t.getAttribute(n)}))})),this.formatAttrs=e,t.select()},e.prototype.isNeedSyncState=function(t){return!0},e.prototype.syncElementState=function(t){var e=this.formatAttrs;return e&&Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])})),t},e.prototype.applyFormat=function(){var t=this.formatAttrs,e=this.getRange();t&&!e.collapsed?(this.execCommandAtRange(),(e=this.getRange()).select()):e.select()},e.prototype.execute=function(t){var e=t.type;return"extract"===e?this.extractFormat():"apply"===e?this.applyFormat():void("cancel"===e&&this.cancel())},e}(jr),ai=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),li=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.commandType=nt,e}return ai(e,t),e.prototype.selectElement=function(t){if(t){var e=this.selectActiveElementType;e||(e=this.selectActiveElementType=new F);var n=this.selectActiveElement;return n||(n=this.selectActiveElement=e.create()),n.parentNode!==t?(this.setSelectVisible(!0),this.cancelSelect(),t.appendChild(n),t.setAttribute("ky-active",""),!0):void 0}},e.prototype.cancelSelect=function(){if(this.selectActiveElement){var t=this.selectActiveElement.parentNode;t&&t.removeAttribute("ky-active"),dt(this.selectActiveElement)}},e.prototype.removeSelect=function(){if(this.selectActiveElement){var t=this.selectActiveElement.parentElement;if(this.cancelSelect(),!t)return null;var e=t.previousElementSibling,n=t.nextElementSibling,r=n,o=0;if(dt(t),Ft(e)&&Ft(n)&&(e.textContent?n.textContent||(r=e,o=e.textContent.length,dt(n)):dt(e)),Ft(r))try{var i=this.commandManager.editor.newRange();i.startElement=r,i.startOffset=o,i.select()}catch(t){console.warn("range losing !")}return t}return null},e.prototype.setSelectVisible=function(t){this.selectActiveElement&&(t?this.selectActiveElement.removeAttribute("class"):this.selectActiveElement.className=Ze("hidden"))},e.prototype.execute=function(t){var e,n=(t=t||{}).type;if("select"===n)return this.selectElement(t.element);if("getSelect"===n){var r=null===(e=this.selectActiveElement)||void 0===e?void 0:e.parentElement;return!!r?r:null}return"setVisible"===n?this.setSelectVisible(t.visible):"cancelSelect"===n?this.cancelSelect():"removeSelect"===n?this.removeSelect():void 0},e}(rt);lt.install("bold",Dr),lt.install("italic",Wr),lt.install("link",Kr),lt.install("style",Pr),lt.install("delete",Qr),lt.install("backspace",Gr),lt.install("enter",no),lt.install("input",to),lt.install("textInput",oo),lt.install("list",Se),lt.install("insertBox",lo),lt.install("insertImage",po),lt.install("tab",mo),lt.install("blockStyle",bo),lt.install("sup",So),lt.install("sub",To),lt.install("log",ko),lt.install("textDecoration",Lo),lt.install("stroke",Lo.Stroke),lt.install("underline",Lo.Underline),lt.install("overline",Lo.Overline),lt.install("split",Do),lt.install("header",Wo),lt.install("paragraph",Qo),lt.install("insertHr",qo),lt.install("insertCheckbox",Xo),lt.install("quote",ei),lt.install("resetText",ri),lt.install("insertCustom",so),lt.install("format",ii),lt.install("selectState",li),lt.install("clipboard",Pe);var ci=n(43),ui=new ci.a;ui.lang(ci.b.get(["en","zh-CN"],"en")),function(t){t.use(n(235))}(ui);var si=ui.forkWithPrefix("editor."),fi=Array.prototype.slice;function pi(t){return u.isElementInstanceOf(t,an)}function di(t){return fi.call(t.querySelector("colgroup").children)}function hi(t){for(var e=t;e;)if(pi(e=e.parentNode))return e}function mi(t,e,n){return n>=t&&n<=e}function yi(t,e){var n=an.getElementModel(t),r=n.getCols();if(e){var o=e.cols.reduce((function(t,e){return t+e}),0);e.cols.forEach((function(t,e){var n=t/o*100;r[e].style.width="".concat(n,"%")})),e.needSyncTableSize&&(n.table.style.width="".concat(o,"px"))}else{var i=n.table.getBoundingClientRect().width,a=[],l=r.reduce((function(t,e){var n=an.getColWidth(e,i);return a.push(n),t+n}),0),c=i/l;yi(t,{cols:a=a.map((function(t){return t*c}))})}}function gi(t,e,n){if(2===arguments.length)return 0|(e.getAttribute(t)||1);1===n?e.hasAttribute(t)&&e.removeAttribute(t):e.setAttribute(t,String(n))}function vi(t,e){var n=fi.call(arguments);return n.unshift("rowspan"),gi.apply(null,n)}function bi(t,e){var n=fi.call(arguments);return n.unshift("colspan"),gi.apply(null,n)}var xi=function(t){function e(){return t.getProxyElement()}return{pushLog:function(){t.editor.saveLog()},getProxyElement:e,getTables:function(){return t.getTables()},findCell:function(t){return ct.a.findUpUtil(t.target,(function(t){return(e=t)&&"td"===(e.tagName||"").toLowerCase()&&pi(null===(r=null===(n=null==e?void 0:e.parentNode.parentNode)||void 0===n?void 0:n.parentNode)||void 0===r?void 0:r.parentElement);var e,n,r}),(function(t){return pi(t)||t===e()}))},isResizing:function(){},isSelectMoving:function(){}}},Ci=Array.prototype.slice,Ei=function(t){function e(t,e){var n=tn(di(t).length).tr;n.setAttribute("index",String(e));var r=an.getElementModel(t),o=r.getRows(),i=r.tbody,a=o.length,l=o[e],c=Ci.call(n.children);t:for(var u=0;u<e;u++){if(h=o[u])for(var s=Ci.call(h.children),f=s.length,p=function(t){var n=s[t],r=0|n.getAttribute("index"),o=bi(n),i=r,a=r+o-1,l=vi(n),f=u,p=u+l-1,d=!1;if(c=c.filter((function(t){var n=0|(t.getAttribute("index")||1);return!mi(f,p,e)||!mi(i,a,n)||(dt(t),d=!0,!1)})),d&&vi(n,l+1),0===c.length)return"break-removeSomeCells"},d=0;d<f;d++){switch(p(d)){case"break-removeSomeCells":break t}}}for(u=e;u<a;u++){var h,m=0|(h=o[u]).getAttribute("index");h.setAttribute("index",String(m+1))}l?i.insertBefore(n,l):i.appendChild(n)}function n(t,e){var n=an.getElementModel(t),r=di(t)[e],o=document.createElement("col");o.style.width="80px";var i=!1;r?n.colgroup.insertBefore(o,r):(n.colgroup.appendChild(o),i=!0);for(var a=n.getRows(),l=a.length,c={},u=0;u<l;u++){var s=a[u];if(i)(C=$e().element).setAttribute("index",e),s.appendChild(C);else for(var f=Ci.call(s.children),p=f.length,d=0;d<p;d++){var h=f[d],m=0|h.getAttribute("index"),y=bi(h),g=m+y-1;if(!c["".concat(u,"-").concat(m)])if(mi(m+1,g,e)){bi(h,y+1);for(var v=vi(h),b=u;b<u+v;b++)for(var x=m;x<m+y;x++)c["".concat(b,"-").concat(x)]=!0}else if(m>=e){var C;if(!c["".concat(u,"-").concat(e)])(C=$e().element).setAttribute("index",e),s.insertBefore(C,h),c["".concat(u,"-").concat(e)]=!0;h.setAttribute("index",String(m+1))}}}yi(t)}return{addRowBefore:function(t,n){e(t,0|n.parentElement.getAttribute("index"))},addRowAfter:function(t,n){e(t,(0|n.parentElement.getAttribute("index"))+vi(n))},addColBefore:function(t,e){n(t,0|e.getAttribute("index"))},addColAfter:function(t,e){n(t,(0|e.getAttribute("index"))+bi(e))},deleteCurrentCellRow:function(t,e){!function(t,e){for(var n=an.getElementModel(t),r=n.getRows(),o=n.getCols(),i=r[e],a=i,l={};a;){for(var c=Ci.call(a.children),u=0|a.getAttribute("index"),s=0;s<c.length;s++){var f=0|(m=c[s]).getAttribute("index"),p=bi(m);if(mi(u,u+(g=vi(m))-1,e))for(var d=f;d<f+p;d++)l[d]=m;if(Object.keys(l).length===o.length)break}a=a.previousElementSibling}for(var h=0;h<o.length;h++){var m;if(!(m=l[h]))return;var y=m.parentElement,g=(u=0|y.getAttribute("index"),vi(m));if(u<e)vi(m,g-=1),h+=(p=bi(m))-1;else if(u===e&&g>1){vi(m,g-1);d=0|m.getAttribute("index");h+=(p=bi(m))-1;for(var v=y.nextElementSibling,b=v.firstElementChild,x=void 0;b;){if((0|b.getAttribute("index"))>d){x=b;break}b=b.nextElementSibling}x?v.insertBefore(m,x):v.appendChild(m)}}var C=i.nextElementSibling;for(dt(i);C;){f=0|C.getAttribute("index");C.setAttribute("index",String(f-1)),C=C.nextElementSibling}}(t,e.parentElement.getAttribute("index"))},deleteCurrentCell:function(t,e){!function(t,e){var n=an.getElementModel(t),r=n.getRows();dt(n.getCols()[e]);for(var o={},i=0;i<r.length;i++)for(var a=r[i],l=Ci.call(a.children),c=l.length,u=0;u<c;u++){var s=l[u],f=0|s.getAttribute("index"),p=bi(s),d=f+p-1,h="".concat(i,"-").concat(f);f>e?s.setAttribute("index",String(f-1)):mi(f,d,e)&&(p>1?(o[h]||bi(s,p-1),o[h]=!0):dt(s))}yi(t)}(t,e.getAttribute("index"))},deleteTable:function(e){t.editor.execCommand("selectState",{type:"removeSelect"})}}},Oi=qe("select-none"),_i=function(t,e){var n=e.getProxyElement,r=e.getTables,o=e.findCell,i=e.pushLog;function a(t){var e=o(t.native||t);if(e){var n=e.getBoundingClientRect(),i=ct.a.getPosition(t).x-n.x;if(i>5&&i<n.width-5)return}var a=r(),l={};if(a.some((function(e){var n=e.firstElementChild;if(n){var r=ct.a.getPosition(t,n),o=n.getBoundingClientRect();if(!(r.x<5||r.x-o.width>5||r.y<5||r.y-o.height>5)){var i=o.width,a=0,c=di(e);return c.pop(),c.some((function(t){var n=an.getColWidth(t,i);if(a+=n,Math.abs(r.x-a)<=5)return l.colElement=t,l.x=a,l.table=e,l.tableWidth=i,l.colWidth=n,!0}))}}})),l.table)return l}var l={resizeLog:!1,resizeTarget:null,resizeInfo:null,startEventPos:null};t.register("mousemove:tableResizeMove",n),t.register("mousedown:tableResizeStart",(function(t){if(0===t.button)return a(t)})),t.register("mouseup:tableResizeEnd,mouseleave:tableResizeEnd",(function(t){if(0===t.button)return l.resizeTarget?t.target:void 0})),t.on("tableResizeStart",(function(e){!function(e){l.resizeLog||(l.resizeLog=!0,i());l.resizeTarget=e.target,l.startEventPos=ct.a.getPosition(e),function(e){if(!e)return;t.editor.getContainer().setAttribute(Oi,"")}(l.resizeTarget.table)}(e)}));var c,u=(c=null,function(){return c||(c=(new en).create())});function s(e){l.resizeLog=!1;var n=l.resizeTarget;if(n){var r=n.table;if(l.resizeInfo){var o=l.resizeInfo,i=o.colElement,a=o.colWidth,c=o.originColWidth,s=o.originTableWidth,f=i.nextElementSibling,p=a-c,d=an.getElementModel(r).getCols(),h={cols:[],needSyncTableSize:!f};d.forEach((function(t){t===i?h.cols.push(a):t===f?h.cols.push(an.getColWidth(t,s)-p):h.cols.push(an.getColWidth(t,s))})),yi(r,h)}dt(u()),function(e){e&&t.editor.getContainer().removeAttribute(Oi)}(r),l.resizeTarget=null,l.resizeInfo=null}}return t.on("tableResizeMove",(function(r){if(l.resizeTarget||e.isSelectMoving())r.stopPropagation(),function(t){var e=l.resizeTarget;if(e){var r=ct.a.getPosition(t),o=l.startEventPos,i=r.x-o.x,a=e.tableWidth,c=u(),s=n(),f=ct.a.getElementScale(s),p=f.x,d=f.y;if(c.parentElement!==s){var h=s.getBoundingClientRect(),m=e.table.getBoundingClientRect(),y=m.x-h.x,g=m.y-h.y,v=m.height/(d||1);y/=p||1,g/=d||1,y+=s.scrollLeft,g+=s.scrollTop,c.style.left="".concat(y,"px"),c.style.top="".concat(g,"px"),c.style.height="".concat(v,"px"),s.appendChild(c)}var b=e.colElement.nextElementSibling,x=e.colWidth,C=-(x-10),E=b?an.getColWidth(b,a)-10:0;i<C&&(i=C),b&&i>E&&(i=E);var O=(a+(b?0:i))/(p||1);c.style.width="".concat(O,"px");var _=(e.x+i-e.table.scrollLeft)/(p||1);c.firstElementChild.style.left="".concat(_,"px");var w=e.colWidth+i;l.resizeInfo={colElement:e.colElement,originTableWidth:a,originColWidth:x,colWidth:w}}}(r);else{var o=a(r),i=t.editor.getWrapper();i.style.cursor=o?"col-resize":""}})),t.on("tableResizeEnd",(function(t){s()})),e.isResizing=function(){return!!l.resizeTarget},{}},wi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Si=function(){function t(t,e){this.children=[],this.selector=t||"",this.content=e||""}return t.createElement=function(){var t=document.createElement("style");return t.type="text/css",t},t.prototype.add=function(t){this.children.push(t)},t.prototype.remove=function(t){var e=this.children.indexOf(t);-1!==e&&this.children.splice(e,1)},t.prototype.toString=function(t){void 0===t&&(t="");var e=this.selector||"",n=this.children.map((function(t){return t.toString(e)})).join("\n"),r="".concat(t).concat(e);return r?"".concat(r,"{\n").concat(this.content||"","}\n")+n:n||this.content?"\n".concat(this.content||"","\n").concat(n,"\n"):""},t.prototype.toElement=function(){var e=t.createElement();return e.textContent=this.toString(),e},t}(),Ai=Si,Ti=(function(t){function e(e,n){var r=":nth-child(".concat(e,")");return t.call(this,r,n)||this}wi(e,t)}(Si),Array.prototype.slice),Ni=qe("select-none"),Ri=function(t){var e=document.createDocumentFragment();if(yt(t))return e;var n=t.firstElementChild;if(u.isElementInstanceOf(n,a))for(;n.firstElementChild;)e.appendChild(n.firstElementChild);return e},ji=function(t,e){var n=e.getProxyElement,r=e.findCell;var o={selectionStartTarget:null,selectionMoveTarget:null};t.register("mousemove:tableSelectMove",(function(t){if(!e.isResizing())return ct.a.findUpUtil(t.target,(function(t){return pi(t)}),(function(t){return t===n()}))})),t.register("mousedown:tableSelectStart",(function(t){if(0===t.button&&!u.isElementInstanceOf(t.target,g)){var e=r(t);return e||void 0}})),t.register("mouseleave:tableSelectEnd",(function(t){if(0===t.button)return o.selectionStartTarget?t.target:void 0})),t.register("mouseup:tableSelectEnd",(function(t){if(0===t.button)return t.target})),t.on("tableSelectStart",(function(e){!function(e){var n=e.target;o.selectionStartTarget=n,o.selectionMoveTarget=n,i=function(){!function(e){if(!e)return;t.editor.getContainer().setAttribute(Ni,"")}(hi(n))}}(e)}));var i=null;var l,c,s=(c=1,function(){return l?{element:l,id:c++}:{element:l=Ai.createElement(),id:c++}});function f(t,e){if(t){var n=an.getElementModel(t),r=e||{},o=r.minRow,i=r.maxRow,a=r.minCol,l=r.maxCol;t._selectOptions=e;for(var c,u,f=qe("style-id"),p=n.getRows(),d=p.length,h=s(),m=h.element,y=h.id,g=[],v=o;e&&v<=i&&v<d;v++)for(var b=v>=o&&v<=i,x=p[v],C=x.children,E=x.childElementCount,O="[".concat(f,'="').concat(y,'"]>table>tbody>tr[index="').concat(v,'"]'),_=0;_<E;_++){var w=C[_],S=0|w.getAttribute("index");if(S>l)break;if(b&&S>=a&&S<=l){var A=bi(w),T=v===o,N=v+vi(w)-1===i,R=S===a,j=S+A-1===l,k='>td[index="'.concat(S,'"]'),M="".concat(O).concat(k),P=[],I="".concat(2,"px;");R&&P.push("\n              border-left-width:".concat(I,";\n            ")),j&&P.push("\n              border-right-width:".concat(I,";\n            ")),T&&P.push("\n              border-top-width:".concat(I,";\n            ")),N&&P.push("\n              border-bottom-width:".concat(I,";\n            ")),P.length>0&&(g.push("".concat(M,":before{\n              content:'';\n              ").concat(P.join("\n"),"\n            }")),g.push("".concat(M,":after{\n              content:'';\n              ").concat(P.join("\n"),"\n            }"))),c||(c=w),u=w}}0===g.length?(dt(m),m.textContent="",t.removeAttribute(f)):(t.setAttribute(f,"".concat(y)),m.parentElement!==t&&t.appendChild(m),m.textContent=g.join("\n")),e&&(e.cellSelection={startCell:c,endCell:u})}}function p(t,e,n){var r=0|t.getAttribute("index"),o=bi(t),i=e,a=i+vi(t)-1,l=r+o-1,c={minRow:i,maxRow:a,minCol:r,maxCol:l},u=function(t,e){return mi(t.minCol,t.maxCol,e.minCol)||mi(t.minCol,t.maxCol,e.maxCol)?mi(e.minRow,e.maxRow,t.minRow)||mi(e.minRow,e.maxRow,t.maxRow):mi(t.minRow,t.maxRow,e.minRow)||mi(t.minRow,t.maxRow,e.maxRow)?mi(e.minCol,e.maxCol,t.minCol)||mi(e.minCol,e.maxCol,t.maxCol):void 0},s=Object.assign({},n),f=!1;return(u(n,c)||u(c,n))&&(s.minRow>i&&(s.minRow=i,s.updated=!0),s.minCol>r&&(s.minCol=r,s.updated=!0),s.maxRow<a&&(s.maxRow=a,s.updated=!0),s.maxCol<l&&(s.maxCol=l,s.updated=!0),f=!0),{area:s,success:f,point:{minRow:i,maxRow:a,minCol:r,maxCol:l}}}function d(t){var e=o.selectionStartTarget;if(e){var n=o.selectionMoveTarget,a=r(t.native);if(a&&(o.selectionMoveTarget=a,n!==e)){i&&(i(),i=null);var l={rowIndex:0|a.parentNode.getAttribute("index"),colIndex:0|a.getAttribute("index"),rowspan:vi(a),colspan:bi(a)},c={rowIndex:0|e.parentNode.getAttribute("index"),colIndex:0|e.getAttribute("index"),rowspan:vi(e),colspan:bi(e)},u=Math.min(l.rowIndex,c.rowIndex),s=Math.max(l.rowIndex+l.rowspan-1,c.rowIndex+c.rowspan-1),d=Math.min(l.colIndex,c.colIndex),h=Math.max(l.colIndex+l.colspan-1,c.colIndex+c.colspan-1),m=hi(e),y=hi(a);if(m!==y)return o.selectionStartTarget=o.selectionMoveTarget=a,void f(m);f(y,function t(e,n){for(var r=an.getElementModel(e).getRows(),o=r.length,i=-1,a=-1,l=-1,c=-1,u=!1,s=0;s<o;s++){var f=r[s],d=f.children,h=f.childElementCount,m=0|f.getAttribute("index");if(m>n.maxRow)break;for(var y=0;y<h;y++){var g=p(d[y],m,n),v=g.area,b=g.success,x=g.point;if(v.updated)return v.updated=!1,t(e,v);if(b){var C=x.minRow,E=x.maxRow,O=x.minCol,_=x.maxCol;u?(O<i&&(i=O),_>a&&(a=_),C<l&&(l=C),E>c&&(c=E)):(i=O,a=_,l=C,c=E,u=!0)}}}return{minRow:l,maxRow:c,minCol:i,maxCol:a}}(y,{minRow:u,maxRow:s,minCol:d,maxCol:h}))}}}function h(e){return t.editor.commandManager.execCommand("tableSelection",e)}function m(){var e=hi(o.selectionStartTarget),n=h({type:"getSelection"});if(e){if(function(e){e&&t.editor.getContainer().removeAttribute(Ni)}(e),i)i=null,n&&n.table!==e?f(n.table):f(e),h({type:"setSelection",value:null});else if(o.selectionStartTarget){t.editor.removeRanges();var r=e._selectOptions;n&&n.table!==e&&f(n.table),r&&h({type:"setSelection",value:{table:e,selectOptions:r}})}o.selectionStartTarget=null,o.selectionMoveTarget=null}else n&&(h({type:"setSelection",value:null}),f(n.table))}return t.on("tableSelectMove",(function(t){d(t)})),t.on("tableSelectEnd",(function(t){m()})),e.isSelectMoving=function(){return!!o.selectionStartTarget},{mergeCells:function(t){var e=t._selectOptions;if(e){for(var n=an.getElementModel(t),r=e.minRow,o=e.maxRow,i=e.minCol,l=e.maxCol,c=n.getRows(),s=[],f=null,p=r;p<=o;p++)for(var d=c[p],h=Ti.call(d.children),m=h.length,y=0;y<m;y++){var g=h[y],v=0|g.getAttribute("index");v<i||v>l||(p>r||v!==i?(s.push(Ri(g)),dt(g)):(f=g,bi(g,l-i+1),vi(g,o-r+1)))}f&&u.isElementInstanceOf(f.firstElementChild,a)&&s.forEach((function(t){f.firstElementChild.appendChild(t)}))}},selectTableArea:f}},ki=n(50),Mi=function(t){var e=function(t){var e,n,r=function(t){for(var e=t.firstElementChild;e;){if("style"===String(e.tagName).toLowerCase()&&e.hasAttribute("style-setting"))return e;e=e.nextElementSibling}return e||((e=Ai.createElement()).setAttribute("style-setting",""),t.appendChild(e)),e}(t),o=r.getAttribute("style-setting"),i={};if(o)try{n={},i=(e=o)?(e.split(";").forEach((function(t){var e=t.split(":");2===e.length&&(n[e[0]]=e[1])})),n):n}catch(t){}return{table:t,setting:i,element:r}},n=function(t){var e=t.setting,n=t.element,r=t.table,o=r.getAttribute("tid");o||(o="id_"+Date.now(),r.setAttribute("tid",o));var i,a=[],l="".concat(an.tagName,"[").concat("tid",'="').concat(o,'"]>table'),c="".concat(l,">tbody>tr>td");e.borderColor&&(a.push("".concat(l,"{border-color:").concat(e.borderColor,";}")),a.push("".concat(c,"{border-color:").concat(e.borderColor,";}"))),e.borderSize&&(a.push("".concat(l,"{border-width:").concat(e.borderSize,";}")),a.push("".concat(c,"{border-width:").concat(e.borderSize,";}"))),e.bgColor&&a.push("".concat(l,"{background-color:").concat(e.bgColor,";}")),n.textContent=a.join("\n"),n.setAttribute("style-setting",(i=e,Object.keys(i).map((function(t){return"".concat(t,":").concat(i[t])})).join(";")))},r=function(t,r,o){var i=e(t);i.setting[r]=o,n(i)};return{setTableBorderColor:function(t,e){r(t,"borderColor",e)},setTableBorderSize:function(t,e){r(t,"borderSize",e)},setTableBgColor:function(t,e){r(t,"bgColor",e)}}};n(233);var Pi={apply:function(t){var e=Ei(t),n=e.addRowBefore,r=e.addRowAfter,o=e.addColBefore,i=e.addColAfter,a=e.deleteCurrentCellRow,l=e.deleteCurrentCell,c=e.deleteTable,s=xi(t),f=s.getProxyElement,p=s.pushLog,d=s.findCell,h=ji(t,s),m=h.selectTableArea,y=h.mergeCells,g=Mi(),v=g.setTableBorderColor,b=g.setTableBorderSize,x=g.setTableBgColor;function C(){var e=t.editor.getWrapper();e._contextMenu&&dt(e._contextMenu),e._contextMenu=null}function E(e,n){var r=n.items,o=t.editor.getWrapper(),i=ct.a.getPosition(e),a=document.createElement("div");a.className=Ze("context-menu"),r.forEach((function(t){a.appendChild(function(t){var e=document.createElement("div");return e.className=Ze("context-menu-item"),e.innerHTML=t.html,t.handler&&e.addEventListener("click",(function(e){p(),t.handler(e)})),t.create&&(e.setAttribute("ext",""),e.appendChild(t.create())),e}(t))}));var l=i.x,c=i.y;a.style.left="".concat(l,"px"),a.style.top="".concat(c,"px"),a.addEventListener("click",(function(t){t.stopPropagation()}));var u=document.createElement("div");u.className=Ze("context-menu-wrapper"),u.appendChild(a),u.addEventListener("contextmenu",(function(t){return t.preventDefault()})),o._contextMenu=u,u.addEventListener("click",C),document.body.appendChild(u)}function O(t){var e=document.createElement("div");e.className=Ze("ctx-sub-menu-item"),e.setAttribute("type","color-picker");var n=new ki.a;return n.eventManager.on("change",(function(e){p(),t(e)})),e.appendChild(n.render()),e.addEventListener("click",(function(t){return t.stopPropagation()})),e}t.register("contextmenu:tableContextMenu",(function(t){var e=ct.a.findUpUtil(t.target,(function(t){return pi(t)}),(function(t){return t===f()}));if(e&&function(t){var e=null==t?void 0:t.parentElement;return u.isElementInstanceOf(null==e?void 0:e.nextElementSibling,F)}(e))return e})),t.onNative("mousedown",(function(t){0===t.button&&C()})),t.on("tableContextMenu",(function(e){e.stopPropagation(),e.preventDefault(),C();var u=d(e.native),s=e.target,f={items:[]},h=t.editor.getNormalizedRange(),g=function(){C(),m(s),h&&h.select()};if(u&&(f.items=[{html:si.get({lid:"table.fitWidth",default:"fit width"}),handler:function(){var t,e=null===(t=s.parentElement)||void 0===t?void 0:t.parentElement;e&&(e.style.width="100%"),g()}},{html:si.get({lid:"table.fitHeight",default:"fit height"}),handler:function(){var t,e=null===(t=s.parentElement)||void 0===t?void 0:t.parentElement;e&&(e.style.height="auto"),g()}},{html:si.get({lid:"table.insertRowBefore",default:"insert row before current"}),handler:function(){n(s,u),g()}},{html:si.get({lid:"table.insertRowAfter",default:"insert row after current"}),handler:function(){r(s,u),g()}},{html:si.get({lid:"table.insertColBefore",default:"insert column before current"}),handler:function(){o(s,u),g()}},{html:si.get({lid:"table.insertColAfter",default:"insert column after current"}),handler:function(){i(s,u),g()}},{html:si.get({lid:"table.deleteCurrentRow",default:"delete current row"}),handler:function(){a(s,u),g()}},{html:si.get({lid:"table.deleteCurrentCol",default:"delete current column"}),handler:function(){l(s,u),g()}}]),s._selectOptions){var _=s._selectOptions,w=_.minCol,S=_.maxCol,A=_.minRow,T=_.maxRow,N=u.getAttribute("index"),R=u.parentNode.getAttribute("index");if(mi(w,S,N)&&mi(A,T,R)){var j=[{html:si.get({lid:"table.mergeCells",default:"merge cells"}),handler:function(){y(s),g()}}];f.items=f.items.concat(j)}}f.items.push({html:si.get({lid:"table.deleteTable",default:"delete table"}),handler:function(){c(s),g()}}),f.items.push({html:si.get({lid:"table.borderSize",default:"border size"}),handler:function(){g()},create:function(){return function(t){var e=document.createElement("div");e.className=Ze("ctx-sub-menu-item"),e.setAttribute("type","dropdown");var n=Object(ct.i)("dataKey");return Array(8).fill(0).forEach((function(t,r){var o=document.createElement("div");o[n]=!0;var i=8-r-1;o.setAttribute("key",String(i)),o.textContent="".concat(i,"px"),e.appendChild(o)})),e.addEventListener("click",(function(r){var o=ct.a.findUpUtil(r.target,(function(t){if(t[n])return!!t}),(function(t){return t===e}));o&&(p(),t(o.getAttribute("key")+"px"))})),e}((function(t){b(s,t)}))}}),f.items.push({html:si.get({lid:"table.borderColor",default:"border color"}),handler:function(){g()},create:function(){return O((function(t){v(s,t)}))}}),f.items.push({html:si.get({lid:"table.bgColor",default:"background color"}),handler:function(){g()},create:function(){return O((function(t){x(s,t)}))}}),E(e,f)}))},applyBase:function(t){var e=xi(t);_i(t,e)}},Ii=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Bi=function(t){function e(e){var n=t.call(this,e)||this;return n._tables=Object.create(null),n}return Ii(e,t),e.prototype.putTable=function(t,e){this._tables[t]=e},e.prototype.removeTable=function(t){delete this._tables[t]},e.prototype.getTables=function(){return Object.values(this._tables)},e}(vr),zi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Li=function(t){function e(e){return t.call(this,e)||this}return zi(e,t),e.prototype.execute=function(e){if(this.getRange().collapsed){var n=e.cols,r=void 0===n?3:n,o=e.rows,i=void 0===o?3:o;t.prototype.execute.call(this,{attrs:{meta:"".concat(i,",").concat(r)},innerHTML:!0,rotate:!1,resize:["Right","Bottom"],type:"table"})}},e}(so),Vi=Array.prototype.slice,Di=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.commandType=nt,e._selection=null,e}return zi(e,t),e.prototype.setCellBgColor=function(t){var e=this._selection;if(e)for(var n=e.table,r=e.selectOptions,o=r.minCol,i=r.maxCol,a=r.minRow,l=r.maxRow,c=an.getElementModel(n),u=Vi.call(c.getRows()),s=a;s<=l&&s<u.length;s++){var f=u[s];if(!(s<a||s>l))for(var p=f.firstElementChild;p;){var d=0|p.getAttribute("index");if(d>=o&&d<=i){var h=_t(p);h["background-color"]=t,p.setAttribute("style",h.toString())}p=p.nextElementSibling}}},e.prototype.getStyle=function(t){var e=t.styleNames,n=[].concat(e).reduce((function(t,e){return t[e]=!0,t}),{}),r={},o=this._selection;if(!o)return r;for(var i=o.table,a=o.selectOptions,l=a.minCol,c=a.maxCol,u=a.minRow,s=a.maxRow,f=an.getElementModel(i),p=Vi.call(f.getRows()),d=u;d<=s&&d<p.length;d++){var h=p[d];if(!(d<u||d>s))for(var m=h.firstElementChild;m;){var y=0|m.getAttribute("index");y>=l&&y<=c&&Pr.fillStyleValues(m,r,n),m=m.nextElementSibling}}return r},e.prototype.getState=function(t){void 0===t&&(t={});var e=this.createState();return"style"===t.type&&(e.data=this.getStyle.apply(this,arguments)),e},e.prototype.execute=function(t){var e=(t||{}).type;return"getSelection"===e?this._selection:"setSelection"!==e?"setCellBgColor"===e?this.setCellBgColor(t.value):void 0:void(this._selection=t.value)},e}(rt),Ui=Object(ct.i)("TableEvents"),Wi=Object(ct.i)("BaseTableEvents"),Hi=1;u.register(new an),lt.install("insertTable",Li),lt.install("tableSelection",Di),Tr.defineCustomMount("table",(function(t,e){var n="".concat(Hi++),r=e.get(Ui),o=e.get(Wi);o||(o=new Bi(e),Pi.applyBase(o),o.mount(e.getWrapper()),e.put(Wi,o)),r||(r=new Bi(e),Pi.apply(r),e.isEditMode()&&r.mount(e.getWrapper()),e.events.on("editModeChange",(function(t){t?r.mount(e.getWrapper()):r.unmount()})),e.put(Ui,r));var i=t.firstElementChild;if(i){var a=Tr.getElementsByElementType(i,W);null==a||a.forEach((function(t){e.mountCustomElement(t)}))}else{var l=t.getAttribute("meta"),c=3,s=3;if(l){var f=l.split(","),p=parseInt(f[0]||""),d=parseInt(f[1]||"");p&&(c=p),d&&(s=d)}i=u.createElement(an,{cols:s,rows:c}),t.appendChild(i)}return t.style.width="100%",r.putTable(n,i),o.putTable(n,i),function(){r.removeTable(n),o.removeTable(n),0===r.getTables().length&&r.unmount(),0===o.getTables().length&&o.unmount()}}));var Fi=Tr,qi=function(){function t(t){this.editor=t}return t.prototype.getState=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.editor.commandManager,o=r.getCommand(t);return o&&this.editor.execute((function(){return o.getState.apply(o,e)}))||{data:null}},t}(),Zi=function(t,e){var n=new qi(e),r={text:["bold","stroke","italic","underline","overline","quote","formatFill","fontSize","fontColor","textBgColor","textAlign","lineHeight","indent","ol","ul","table","image","hr","checkbox","textType","formatClean"]};function o(e){r.text.forEach((function(n){t.setToolbarItemEnabled(n,e)}))}var i=qe("format-fill");var a,l,c,s={formatFill:function(t){var n=e.getContainer();t?(n.setAttribute(i,""),e.execCommand("format",{type:"extract"})):(n.removeAttribute(i),e.execCommand("format",{type:"cancel"}))},fontSize:function(t){e.execCommand("style",{fontSize:t})},fontColor:function(t){e.execCommand("style",{color:t})},textBgColor:function(t){e.execCommand("style",{backgroundColor:t})},blockBgColor:function(t){(function(t){var n=e.execCommand("selectState",{type:"getSelect"}),r=null==n?void 0:n.firstElementChild;if(u.isElementInstanceOf(r,I))return r.style["background-color"]=t,!0})(t)||(e.commandManager.execCommand("tableSelection",{type:"getSelection"})?e.execCommand("tableSelection",{type:"setCellBgColor",value:t}):e.execCommand("blockStyle",{"background-color":t}))},textAlign:function(t){e.execCommand("blockStyle",{textAlign:t})},lineHeight:function(t){e.execCommand("blockStyle",{lineHeight:t})},indent:function(t){var r=n.getState("style",{type:"block",styleNames:["padding-left"]}).data["padding-left"],o=r&&1===r.length&&parseInt(r[0])||0;"addIndent"===t?o+=24:o-=24,o=Math.max(0,o),e.execCommand("blockStyle",{paddingLeft:"".concat(o,"px")})},ol:function(n){e.execCommand("list",{type:"ol",enabled:n}),t.setToolbarItemValue("ul",!1)},ul:function(n){e.execCommand("list",{type:"ul",enabled:n}),t.setToolbarItemValue("ol",!1)},table:function(t){e.execCommand("insertTable",t)},image:function(t){e.execCommand("insertImage",t)},hr:function(){e.execCommand("insertHr")},checkbox:function(t){e.execCommand("insertCheckbox",t)},textType:function(t){var n=t.match(/h(\d+)/);if(n){var r=n[1];e.execCommand("header",{level:r})}else e.execCommand("paragraph")},formatClean:function(){e.execCommand("resetText")},cancel:function(){e.execCommand("log","cancel")},redo:function(){e.execCommand("log","redo")}};return t.on("itemSelect",(function(t){if(s[t.type])s[t.type](t.data);else{var n=t.type,r=t.data;e.execCommand(n,r)}})),e.on("selectionElementsChange",(function(){clearTimeout(a),a=setTimeout((function(){t.setEnabled(!0);console.time("toolbar-state-sync"),function(){var r=n.getState("style",{styleNames:["font-weight","font-size","font-style","text-decoration","color","background-color"]}).data;r||(r={});var o=n.getState("style",{type:"block",styleNames:["text-align","background-color","line-height"]}).data;o||(o={});var i=n.getState("header").data;if(i){var a=i.level,l=void 0===a?1:a;t.setToolbarItemValue("textType","h".concat(l))}else t.setToolbarItemValue("textType","normal");var c=r["font-size"];if(c&&1===c.length){var u=c[0]||"14px";t.setToolbarItemValue("fontSize",u)}else t.setToolbarItemValue("fontSize","14px");var s=(c=r["font-weight"])&&1===c.length&&"bold"===c[0];t.setToolbarItemValue("bold",s);var f=(c=r["font-style"])&&1===c.length&&"italic"===c[0];t.setToolbarItemValue("italic",f);var p=(c=r["text-decoration"])&&1===c.length&&-1!==String(c[0]).indexOf("line-through");t.setToolbarItemValue("stroke",p);var d=(c=r["text-decoration"])&&1===c.length&&-1!==String(c[0]).indexOf("underline");t.setToolbarItemValue("underline",d);var h=(c=r["text-decoration"])&&1===c.length&&-1!==String(c[0]).indexOf("overline");if(t.setToolbarItemValue("overline",h),(c=r.color)&&1===c.length){var m=c[0];t.setToolbarItemValue("fontColor",m||"")}else t.setToolbarItemValue("fontColor","");if((c=r["background-color"])&&1===c.length){m=c[0];t.setToolbarItemValue("textBgColor",m||"#fff")}else t.setToolbarItemValue("textBgColor","#fff");if((c=o["text-align"])&&1===c.length){var y=c[0]||"left";t.setToolbarItemValue("textAlign",y)}else t.setToolbarItemValue("textAlign","left");if((c=o["line-height"])&&1===c.length){var g=c[0]||"24px";t.setToolbarItemValue("lineHeight",g)}else t.setToolbarItemValue("lineHeight","24px");var v=n.getState("list").data;v?"ul"===v.type?(t.setToolbarItemValue("ul",!0),t.setToolbarItemValue("ol",!1)):(t.setToolbarItemValue("ul",!1),t.setToolbarItemValue("ol",!0)):(t.setToolbarItemValue("ol",!1),t.setToolbarItemValue("ul",!1));var b=n.getState("quote").data;t.setToolbarItemValue("quote",b);var x=e.commandManager.execCommand("tableSelection",{type:"getSelection"}),C=(o["background-color"]||[])[0]||"#fff";if(x){var E=n.getState("tableSelection",{type:"style",styleNames:["background-color"]}).data["background-color"]||[];C=1===E.length?E[0]:"#fff"}t.setToolbarItemValue("blockBgColor",C||"#fff")}(),console.timeEnd("toolbar-state-sync")}),500)})),e.on("selectionchange",(function(){clearTimeout(c),c=setTimeout((function(){var e;e=n.getState("log").data,t.setToolbarItemEnabled("cancel",e.cancel),t.setToolbarItemEnabled("redo",e.redo)}),500)})),e.on("selectionLost",(function(){clearTimeout(l),l=setTimeout((function(){o(!1)}),300)})),e.on("selectionGet",(function(){clearTimeout(l),o(!0)})),e.on("selectStateChange",(function(e){!function(e){var n=null==e?void 0:e.firstElementChild;if(u.isElementInstanceOf(n,I)){var r=_t(n)["background-color"];t.setToolbarItemValue("blockBgColor",r||"#fff"),t.setToolbarItemEnabled("blockBgColor",!0)}else n&&t.setToolbarItemValue("blockBgColor","#fff")}(e)})),e.events.onNative("mouseup",(function(){e.getContainer().hasAttribute(i)&&e.execCommand("format",{type:"apply"})})),t}}}]);